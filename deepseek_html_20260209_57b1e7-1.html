<!DOCTYPE html>
<html lang="sr-RS" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Balkan Gaming Empire - Premium gaming e-commerce sa najvećim izborom video igara i opreme na Balkanu">
    <meta name="keywords" content="gejming, video igre, gaming, kupovina igara, PC igre, PlayStation, Xbox, Nintendo">
    <meta property="og:title" content="Balkan Gaming Empire">
    <meta property="og:description" content="Najveći gaming shop na Balkanu">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://balkan-gaming.com/og-image.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <title>Balkan Gaming Empire - Premium Gaming Shop</title>
    
    <!-- GOOGLE FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- TOASTIFY CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <!-- PAYPAL SDK (disabled for now to avoid errors) -->
    <!-- <script src="https://www.paypal.com/sdk/js?client-id=test&currency=USD" data-sdk-integration-source="button-factory"></script> -->
    
    <style>
        /* ===== ROOT VARIABLES ===== */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #111827;
            --darker: #0a0a1a;
            --light: #f9fafb;
            --gray: #6b7280;
            --gray-dark: #374151;
            --success: #10b981;
            --cyber-blue: #00d1ff;
            --cyber-pink: #ff00ff;
            --cyber-green: #00ff9d;
            --border-radius: 12px;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font-heading: 'Orbitron', sans-serif;
            --font-body: 'Inter', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
        }
        
        [data-theme="light"] {
            --dark: #f9fafb;
            --darker: #f3f4f6;
            --light: #111827;
            --gray: #6b7280;
            --gray-dark: #9ca3af;
        }
        
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: var(--font-body);
            background-color: var(--darker);
            color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 255, 0.05) 0%, transparent 50%),
                linear-gradient(45deg, rgba(16, 185, 129, 0.02) 0%, transparent 100%);
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ===== TYPOGRAPHY ===== */
        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-heading);
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            background: linear-gradient(90deg, var(--cyber-blue), var(--cyber-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        h2 {
            font-size: 2.25rem;
            color: var(--light);
            position: relative;
            display: inline-block;
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }
        
        h3 {
            font-size: 1.5rem;
            color: var(--light);
        }
        
        h4 {
            font-size: 1.25rem;
            color: var(--light);
        }
        
        p {
            margin-bottom: 1rem;
            color: var(--gray);
        }
        
        a {
            color: var(--cyber-blue);
            text-decoration: none;
            transition: var(--transition);
        }
        
        a:hover {
            color: var(--cyber-pink);
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-family: var(--font-heading);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            position: relative;
            overflow: hidden;
            z-index: 1;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
            z-index: -1;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background-color: transparent;
            color: var(--cyber-green);
            border: 2px solid var(--cyber-green);
        }
        
        .btn-secondary:hover {
            background-color: rgba(0, 255, 157, 0.1);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--light);
            border: 2px solid var(--gray-dark);
        }
        
        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-success {
            background-color: var(--success) !important;
            border-color: var(--success) !important;
        }
        
        /* ===== FORMS ===== */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--light);
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--gray-dark);
            border-radius: var(--border-radius);
            color: var(--light);
            font-family: var(--font-body);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-control::placeholder {
            color: var(--gray);
        }
        
        .form-select {
            width: 100%;
            padding: 12px 16px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--gray-dark);
            border-radius: var(--border-radius);
            color: var(--light);
            font-family: var(--font-body);
            font-size: 1rem;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236b7280' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
        }
        
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1rem;
        }
        
        .form-check-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .form-check-label {
            color: var(--gray);
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .form-error {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 4px;
            display: none;
        }
        
        .form-error.show {
            display: block;
        }
        
        /* ===== LAYOUT COMPONENTS ===== */
        .section {
            padding: 80px 0;
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .card {
            background-color: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            padding: 24px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .card:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-primary {
            background-color: rgba(99, 102, 241, 0.2);
            color: var(--cyber-blue);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }
        
        .badge-success {
            background-color: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .badge-danger {
            background-color: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .badge-warning {
            background-color: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        /* ===== LOADING STATES ===== */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--border-radius);
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ===== TOAST NOTIFICATIONS ===== */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--dark), var(--darker));
            color: var(--light);
            padding: 16px 24px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary);
            box-shadow: var(--shadow);
            z-index: 9999;
            transform: translateX(150%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            max-width: 400px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast-success {
            border-left-color: var(--success);
        }
        
        .toast-error {
            border-left-color: var(--danger);
        }
        
        .toast-warning {
            border-left-color: var(--warning);
        }
        
        /* ===== MODALS ===== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: linear-gradient(135deg, var(--dark), var(--darker));
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
        }
        
        .modal.show .modal-content {
            transform: translateY(0);
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            padding: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }
        
        /* ===== NAVIGATION ===== */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .navbar-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: var(--font-heading);
            font-weight: 800;
            font-size: 1.5rem;
            color: var(--light);
            text-decoration: none;
        }
        
        .logo-icon {
            color: var(--cyber-blue);
            font-size: 2rem;
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 32px;
            list-style: none;
        }
        
        .nav-link {
            color: var(--gray);
            font-weight: 500;
            font-size: 0.95rem;
            transition: var(--transition);
            position: relative;
            padding: 8px 0;
        }
        
        .nav-link:hover {
            color: var(--light);
        }
        
        .nav-link.active {
            color: var(--cyber-blue);
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--cyber-blue), transparent);
        }
        
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .nav-action {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1.25rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .nav-action:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }
        
        .nav-action-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background-color: var(--danger);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* ===== HERO SECTION ===== */
        .hero {
            padding-top: 120px;
            padding-bottom: 80px;
            position: relative;
            overflow: hidden;
        }
        
        .hero-content {
            max-width: 600px;
        }
        
        .hero-title {
            margin-bottom: 1.5rem;
        }
        
        .hero-description {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            color: var(--gray);
        }
        
        .hero-actions {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        .hero-bg {
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
            z-index: -1;
        }
        
        /* ===== PRODUCT GRID ===== */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 3rem;
        }
        
        .product-card {
            position: relative;
        }
        
        .product-card .card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(0, 209, 255, 0.1));
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        .product-image::before {
            content: 'GAME';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: var(--font-heading);
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.1);
            font-weight: 800;
        }
        
        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            z-index: 1;
        }
        
        .product-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--light);
        }
        
        .product-description {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 16px;
            flex-grow: 1;
        }
        
        .product-price {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--cyber-green);
            margin-bottom: 16px;
        }
        
        .product-old-price {
            font-family: var(--font-body);
            font-size: 0.9rem;
            color: var(--gray);
            text-decoration: line-through;
            margin-right: 8px;
        }
        
        .product-actions {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }
        
        /* ===== CART SIDEBAR ===== */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: linear-gradient(135deg, var(--dark), var(--darker));
            z-index: 1001;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .cart-sidebar.show {
            right: 0;
        }
        
        .cart-header {
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .cart-title {
            font-size: 1.25rem;
            color: var(--light);
        }
        
        .cart-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }
        
        .cart-empty {
            text-align: center;
            padding: 48px 24px;
            color: var(--gray);
        }
        
        .cart-empty-icon {
            font-size: 3rem;
            color: var(--gray-dark);
            margin-bottom: 16px;
        }
        
        .cart-items {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .cart-item {
            display: flex;
            gap: 16px;
            padding: 16px;
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .cart-item-image {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(0, 209, 255, 0.1));
            border-radius: 8px;
            flex-shrink: 0;
        }
        
        .cart-item-content {
            flex: 1;
        }
        
        .cart-item-title {
            font-size: 0.95rem;
            color: var(--light);
            margin-bottom: 4px;
        }
        
        .cart-item-price {
            font-family: var(--font-heading);
            color: var(--cyber-green);
            font-size: 1rem;
        }
        
        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 4px 12px;
        }
        
        .cart-item-quantity-btn {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 1rem;
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }
        
        .cart-item-quantity-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }
        
        .cart-item-quantity-value {
            min-width: 24px;
            text-align: center;
            font-weight: 600;
        }
        
        .cart-item-remove {
            background: none;
            border: none;
            color: var(--danger);
            font-size: 1.1rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
            margin-left: auto;
        }
        
        .cart-item-remove:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }
        
        .cart-footer {
            padding: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            font-size: 1.1rem;
        }
        
        .cart-total-label {
            color: var(--gray);
        }
        
        .cart-total-value {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            color: var(--cyber-green);
        }
        
        .cart-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        /* ===== CHECKOUT ===== */
        .checkout-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 48px;
            position: relative;
        }
        
        .checkout-steps::before {
            content: '';
            position: absolute;
            top: 24px;
            left: 20%;
            right: 20%;
            height: 2px;
            background-color: var(--gray-dark);
            z-index: 1;
        }
        
        .checkout-step {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }
        
        .checkout-step-number {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--dark);
            border: 2px solid var(--gray-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--gray);
            margin: 0 auto 12px;
            transition: var(--transition);
        }
        
        .checkout-step.active .checkout-step-number {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        .checkout-step.completed .checkout-step-number {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
        }
        
        .checkout-step-label {
            font-size: 0.9rem;
            color: var(--gray);
            transition: var(--transition);
        }
        
        .checkout-step.active .checkout-step-label {
            color: var(--light);
            font-weight: 600;
        }
        
        .checkout-content {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .checkout-section {
            display: none;
        }
        
        .checkout-section.active {
            display: block;
        }
        
        .order-summary {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .order-summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .order-summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .order-summary-item.total {
            font-weight: 700;
            font-size: 1.1rem;
            padding-top: 12px;
            margin-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ===== USER DASHBOARD ===== */
        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 32px;
        }
        
        .dashboard-sidebar {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: fit-content;
        }
        
        .dashboard-nav {
            list-style: none;
        }
        
        .dashboard-nav-item {
            margin-bottom: 8px;
        }
        
        .dashboard-nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--gray);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }
        
        .dashboard-nav-link:hover {
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--light);
        }
        
        .dashboard-nav-link.active {
            background-color: rgba(99, 102, 241, 0.1);
            color: var(--cyber-blue);
        }
        
        .dashboard-content {
            background-color: rgba(255, 255, 255, 0.03);
            border-radius: var(--border-radius);
            padding: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dashboard-section {
            display: none;
        }
        
        .dashboard-section.active {
            display: block;
        }
        
        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .orders-table th,
        .orders-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .orders-table th {
            color: var(--light);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .orders-table td {
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        .orders-table tr:hover td {
            background-color: rgba(255, 255, 255, 0.03);
        }
        
        /* ===== ADMIN PANEL ===== */
        .admin-panel {
            position: fixed;
            top: 0;
            left: -400px;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            z-index: 1002;
            transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 10px 0 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .admin-panel.show {
            left: 0;
        }
        
        .admin-header {
            padding: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
        }
        
        .admin-title {
            font-size: 1.25rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .admin-body {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }
        
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }
        
        .admin-stat {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-stat-value {
            font-family: var(--font-heading);
            font-size: 2rem;
            color: var(--cyber-green);
            margin-bottom: 8px;
        }
        
        .admin-stat-label {
            font-size: 0.85rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .admin-actions {
            display: grid;
            gap: 12px;
        }
        
        /* ===== FOOTER ===== */
        .footer {
            background-color: rgba(17, 24, 39, 0.95);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 64px 0 32px;
            margin-top: 80px;
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 48px;
            margin-bottom: 48px;
        }
        
        .footer-logo {
            font-family: var(--font-heading);
            font-weight: 800;
            font-size: 1.5rem;
            color: var(--light);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .footer-description {
            color: var(--gray);
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .footer-heading {
            font-size: 1.1rem;
            color: var(--light);
            margin-bottom: 24px;
            font-weight: 600;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-link {
            color: var(--gray);
            text-decoration: none;
            margin-bottom: 12px;
            display: block;
            transition: var(--transition);
            font-size: 0.95rem;
        }
        
        .footer-link:hover {
            color: var(--cyber-blue);
            padding-left: 4px;
        }
        
        .footer-bottom {
            padding-top: 32px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .dashboard-sidebar {
                display: flex;
                overflow-x: auto;
                gap: 16px;
                padding: 16px;
            }
            
            .dashboard-nav {
                display: flex;
                gap: 8px;
            }
            
            .dashboard-nav-item {
                margin-bottom: 0;
            }
            
            .dashboard-nav-link {
                white-space: nowrap;
            }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .nav-menu {
                position: fixed;
                top: 70px;
                left: 0;
                width: 100%;
                background-color: var(--dark);
                flex-direction: column;
                padding: 24px;
                gap: 16px;
                transform: translateY(-100%);
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .nav-menu.show {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            .hero-actions {
                flex-direction: column;
            }
            
            .hero-actions .btn {
                width: 100%;
            }
            
            .checkout-steps {
                flex-direction: column;
                gap: 24px;
            }
            
            .checkout-steps::before {
                display: none;
            }
            
            .checkout-step {
                display: flex;
                align-items: center;
                gap: 16px;
                text-align: left;
            }
            
            .checkout-step-number {
                margin: 0;
            }
            
            .cart-sidebar {
                max-width: 100%;
            }
            
            .admin-panel {
                max-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .section {
                padding: 48px 0;
            }
            
            .modal-content {
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
            }
            
            .product-actions {
                flex-direction: column;
            }
            
            .cart-item {
                flex-direction: column;
                text-align: center;
            }
            
            .cart-item-image {
                margin: 0 auto;
            }
            
            .cart-item-actions {
                justify-content: center;
            }
        }
        
        /* ===== ACCESSIBILITY ===== */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        :focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* ===== PERFORMANCE OPTIMIZATIONS ===== */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* ===== PRINT STYLES ===== */
        @media print {
            .navbar,
            .footer,
            .btn,
            .nav-actions,
            .mobile-menu-toggle {
                display: none !important;
            }
            
            body {
                background-color: white !important;
                color: black !important;
            }
            
            .container {
                max-width: 100% !important;
                padding: 0 !important;
            }
            
            .card {
                border: 1px solid #ddd !important;
                box-shadow: none !important;
                background-color: white !important;
            }
        }
    </style>
</head>
<body>
    <!-- ===== NAVIGATION ===== -->
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="container navbar-container">
            <a href="#" class="logo" aria-label="Balkan Gaming Empire">
                <i class="fas fa-gamepad logo-icon" aria-hidden="true"></i>
                <span>BALKAN GAMING</span>
            </a>
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle menu" aria-expanded="false">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="nav-menu" id="navMenu" role="menubar">
                <li role="none">
                    <a href="#home" class="nav-link active" role="menuitem" data-page="home">Početna</a>
                </li>
                <li role="none">
                    <a href="#shop" class="nav-link" role="menuitem" data-page="shop">Shop</a>
                </li>
                <li role="none">
                    <a href="#categories" class="nav-link" role="menuitem" data-page="categories">Kategorije</a>
                </li>
                <li role="none">
                    <a href="#dashboard" class="nav-link" role="menuitem" data-page="dashboard" style="display: none;" id="dashboardNav">Dashboard</a>
                </li>
            </ul>
            
            <div class="nav-actions">
                <button class="nav-action" id="themeToggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
                
                <button class="nav-action" id="wishlistToggle" aria-label="Wishlist">
                    <i class="fas fa-heart"></i>
                    <span class="nav-action-badge" id="wishlistBadge">0</span>
                </button>
                
                <button class="nav-action" id="cartToggle" aria-label="Shopping cart">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="nav-action-badge" id="cartBadge">0</span>
                </button>
                
                <button class="nav-action" id="userToggle" aria-label="User account">
                    <i class="fas fa-user"></i>
                </button>
                
                <button class="nav-action" id="adminToggle" aria-label="Admin panel" style="display: none;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </nav>
    
    <!-- ===== CART SIDEBAR ===== -->
    <div class="cart-sidebar" id="cartSidebar" role="dialog" aria-label="Shopping cart" aria-hidden="true">
        <div class="cart-header">
            <h3 class="cart-title">Vaša Korpa</h3>
            <button class="modal-close" id="closeCart" aria-label="Close cart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-body" id="cartBody">
            <div class="cart-empty" id="cartEmpty">
                <div class="cart-empty-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <p>Vaša korpa je prazna</p>
                <p>Dodajte igre da počnemo avanturu!</p>
            </div>
            
            <div class="cart-items" id="cartItems" style="display: none;"></div>
        </div>
        
        <div class="cart-footer" id="cartFooter" style="display: none;">
            <div class="cart-total">
                <span class="cart-total-label">Ukupno:</span>
                <span class="cart-total-value" id="cartTotalValue">0 RSD</span>
            </div>
            
            <div class="cart-actions">
                <button class="btn btn-primary btn-block" id="checkoutBtn">
                    <i class="fas fa-lock"></i> Nastavi na Plaćanje
                </button>
                <button class="btn btn-outline btn-block" id="continueShoppingBtn">
                    <i class="fas fa-arrow-left"></i> Nastavi sa Kupovinom
                </button>
            </div>
        </div>
    </div>
    
    <!-- ===== WISHLIST SIDEBAR ===== -->
    <div class="cart-sidebar" id="wishlistSidebar" role="dialog" aria-label="Wishlist" aria-hidden="true">
        <div class="cart-header">
            <h3 class="cart-title">Lista Želja</h3>
            <button class="modal-close" id="closeWishlist" aria-label="Close wishlist">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="cart-body" id="wishlistBody">
            <div class="cart-empty" id="wishlistEmpty">
                <div class="cart-empty-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <p>Lista želja je prazna</p>
                <p>Dodajte igre koje želite!</p>
            </div>
            
            <div class="cart-items" id="wishlistItems" style="display: none;"></div>
        </div>
    </div>
    
    <!-- ===== ADMIN PANEL ===== -->
    <div class="admin-panel" id="adminPanel" role="dialog" aria-label="Admin panel" aria-hidden="true">
        <div class="admin-header">
            <h3 class="admin-title">
                <i class="fas fa-cog"></i> Admin Panel
            </h3>
        </div>
        
        <div class="admin-body">
            <div class="admin-stats">
                <div class="admin-stat">
                    <div class="admin-stat-value" id="adminTotalProducts">0</div>
                    <div class="admin-stat-label">Proizvoda</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="adminTotalOrders">0</div>
                    <div class="admin-stat-label">Porudžbina</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="adminTotalRevenue">0</div>
                    <div class="admin-stat-label">Prihod (RSD)</div>
                </div>
                <div class="admin-stat">
                    <div class="admin-stat-value" id="adminTotalUsers">0</div>
                    <div class="admin-stat-label">Korisnika</div>
                </div>
            </div>
            
            <div class="admin-actions">
                <button class="btn btn-primary btn-block" id="adminAddProductBtn">
                    <i class="fas fa-plus"></i> Dodaj Proizvod
                </button>
                <button class="btn btn-secondary btn-block" id="adminViewOrdersBtn">
                    <i class="fas fa-list"></i> Pregled Porudžbina
                </button>
                <button class="btn btn-outline btn-block" id="adminCloseBtn">
                    <i class="fas fa-times"></i> Zatvori Panel
                </button>
            </div>
        </div>
    </div>
    
    <!-- ===== MODALS ===== -->
    <div class="modal" id="loginModal" role="dialog" aria-label="Login" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Prijava</h3>
                <button class="modal-close" id="closeLoginModal" aria-label="Close login">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email</label>
                        <input type="email" class="form-control" id="loginEmail" required placeholder="vas@email.com">
                        <div class="form-error" id="loginEmailError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Lozinka</label>
                        <input type="password" class="form-control" id="loginPassword" required placeholder="Vaša lozinka">
                        <div class="form-error" id="loginPasswordError"></div>
                    </div>
                    
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="rememberMe">
                        <label class="form-check-label" for="rememberMe">Zapamti me</label>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-sign-in-alt"></i> Prijavi se
                        </button>
                    </div>
                </form>
                
                <div style="text-align: center; margin-top: 16px;">
                    <p style="color: var(--gray); font-size: 0.9rem;">Nemaš nalog? 
                        <a href="#" id="showRegisterModal" style="color: var(--cyber-blue);">Registruj se</a>
                    </p>
                    <p style="color: var(--gray); font-size: 0.9rem; margin-top: 8px;">
                        <a href="#" id="showForgotPasswordModal" style="color: var(--cyber-blue);">Zaboravio/la si lozinku?</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="registerModal" role="dialog" aria-label="Register" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Registracija</h3>
                <button class="modal-close" id="closeRegisterModal" aria-label="Close registration">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label class="form-label" for="registerName">Ime i Prezime</label>
                        <input type="text" class="form-control" id="registerName" required placeholder="Vaše puno ime">
                        <div class="form-error" id="registerNameError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="registerEmail">Email</label>
                        <input type="email" class="form-control" id="registerEmail" required placeholder="vas@email.com">
                        <div class="form-error" id="registerEmailError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="registerPassword">Lozinka</label>
                        <input type="password" class="form-control" id="registerPassword" required placeholder="Minimum 8 karaktera">
                        <div class="form-error" id="registerPasswordError"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="registerConfirmPassword">Potvrdi Lozinku</label>
                        <input type="password" class="form-control" id="registerConfirmPassword" required placeholder="Ponovite lozinku">
                        <div class="form-error" id="registerConfirmPasswordError"></div>
                    </div>
                    
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="acceptTerms" required>
                        <label class="form-check-label" for="acceptTerms">
                            Prihvatam <a href="#" style="color: var(--cyber-blue);">uslove korišćenja</a> i 
                            <a href="#" style="color: var(--cyber-blue);">politiku privatnosti</a>
                        </label>
                        <div class="form-error" id="acceptTermsError"></div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 24px;">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-user-plus"></i> Registruj se
                        </button>
                    </div>
                </form>
                
                <div style="text-align: center; margin-top: 16px;">
                    <p style="color: var(--gray); font-size: 0.9rem;">Već imaš nalog? 
                        <a href="#" id="showLoginModalFromRegister" style="color: var(--cyber-blue);">Prijavi se</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="forgotPasswordModal" role="dialog" aria-label="Forgot password" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Resetovanje Lozinke</h3>
                <button class="modal-close" id="closeForgotPasswordModal" aria-label="Close forgot password">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="forgotPasswordForm">
                    <div class="form-group">
                        <label class="form-label" for="forgotPasswordEmail">Email</label>
                        <input type="email" class="form-control" id="forgotPasswordEmail" required placeholder="Unesite email za resetovanje">
                        <div class="form-error" id="forgotPasswordEmailError"></div>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-paper-plane"></i> Pošalji Link za Reset
                        </button>
                    </div>
                </form>
                
                <div style="text-align: center; margin-top: 16px;">
                    <p style="color: var(--gray); font-size: 0.9rem;">
                        <a href="#" id="showLoginModalFromForgot" style="color: var(--cyber-blue);">Nazad na prijavu</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="addProductModal" role="dialog" aria-label="Add product" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Dodaj Novi Proizvod</h3>
                <button class="modal-close" id="closeAddProductModal" aria-label="Close add product">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="addProductForm">
                    <div class="form-group">
                        <label class="form-label" for="productTitle">Naziv Proizvoda</label>
                        <input type="text" class="form-control" id="productTitle" required placeholder="Npr. Cyberpunk 2077">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productDescription">Opis</label>
                        <textarea class="form-control form-textarea" id="productDescription" required placeholder="Detaljan opis proizvoda..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productPrice">Cena (RSD)</label>
                        <input type="number" class="form-control" id="productPrice" required min="0" step="100" placeholder="Npr. 4499">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productCategory">Kategorija</label>
                        <select class="form-select" id="productCategory" required>
                            <option value="">Izaberite kategoriju</option>
                            <option value="rpg">RPG</option>
                            <option value="fps">FPS</option>
                            <option value="strategy">Strategija</option>
                            <option value="sports">Sport</option>
                            <option value="adventure">Avantura</option>
                            <option value="indie">Indie</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productStock">Količina na stanju</label>
                        <input type="number" class="form-control" id="productStock" required min="0" value="10">
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> Sačuvaj Proizvod
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="modal" id="checkoutModal" role="dialog" aria-label="Checkout" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Plaćanje</h3>
                <button class="modal-close" id="closeCheckoutModal" aria-label="Close checkout">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="checkout-steps">
                    <div class="checkout-step active" data-step="1">
                        <div class="checkout-step-number">1</div>
                        <div class="checkout-step-label">Podaci</div>
                    </div>
                    <div class="checkout-step" data-step="2">
                        <div class="checkout-step-number">2</div>
                        <div class="checkout-step-label">Plaćanje</div>
                    </div>
                    <div class="checkout-step" data-step="3">
                        <div class="checkout-step-number">3</div>
                        <div class="checkout-step-label">Potvrda</div>
                    </div>
                </div>
                
                <div class="checkout-content">
                    <!-- Step 1: Customer Info -->
                    <div class="checkout-section active" id="checkoutStep1">
                        <form id="customerInfoForm">
                            <div class="form-group">
                                <label class="form-label" for="customerName">Ime i Prezime</label>
                                <input type="text" class="form-control" id="customerName" required placeholder="Vaše puno ime">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="customerEmail">Email</label>
                                <input type="email" class="form-control" id="customerEmail" required placeholder="vas@email.com">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="customerPhone">Telefon</label>
                                <input type="tel" class="form-control" id="customerPhone" required placeholder="+381 60 123 4567">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="customerAddress">Adresa</label>
                                <textarea class="form-control form-textarea" id="customerAddress" required placeholder="Ulica i broj, grad, poštanski broj"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary btn-block" id="nextToPaymentBtn">
                                    <i class="fas fa-arrow-right"></i> Nastavi na Plaćanje
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Step 2: Payment -->
                    <div class="checkout-section" id="checkoutStep2">
                        <div class="form-group">
                            <label class="form-label">Način Plaćanja</label>
                            <div class="payment-methods">
                                <div class="form-check" style="margin-bottom: 12px;">
                                    <input type="radio" class="form-check-input" name="paymentMethod" id="paymentCard" value="card" checked>
                                    <label class="form-check-label" for="paymentCard">
                                        <i class="fas fa-credit-card"></i> Kreditna/Debitna kartica
                                    </label>
                                </div>
                                
                                <div class="form-check" style="margin-bottom: 12px;">
                                    <input type="radio" class="form-check-input" name="paymentMethod" id="paymentPaypal" value="paypal">
                                    <label class="form-check-label" for="paymentPaypal">
                                        <i class="fab fa-paypal"></i> PayPal
                                    </label>
                                </div>
                                
                                <div class="form-check" style="margin-bottom: 12px;">
                                    <input type="radio" class="form-check-input" name="paymentMethod" id="paymentCod" value="cod">
                                    <label class="form-check-label" for="paymentCod">
                                        <i class="fas fa-money-bill-wave"></i> Plaćanje po pouzeću
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="cardPaymentFields" style="display: none;">
                            <div class="form-group">
                                <label class="form-label" for="cardNumber">Broj Kartice</label>
                                <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456">
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label class="form-label" for="cardExpiry">Datum Isteka</label>
                                    <input type="text" class="form-control" id="cardExpiry" placeholder="MM/YY">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="cardCvc">CVC</label>
                                    <input type="text" class="form-control" id="cardCvc" placeholder="123">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <button class="btn btn-primary btn-block" id="processPaymentBtn">
                                <i class="fas fa-lock"></i> Potvrdi Plaćanje
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <button class="btn btn-outline btn-block" id="backToInfoBtn">
                                <i class="fas fa-arrow-left"></i> Nazad na Podatke
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Confirmation -->
                    <div class="checkout-section" id="checkoutStep3">
                        <div style="text-align: center; padding: 32px 0;">
                            <div style="font-size: 4rem; color: var(--success); margin-bottom: 24px;">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            
                            <h3 style="margin-bottom: 16px;">Hvala na Kupovini!</h3>
                            <p style="color: var(--gray); margin-bottom: 24px;">
                                Vaša porudžbina je uspešno primljena. Detalji su poslati na vaš email.
                            </p>
                            
                            <div style="background-color: rgba(16, 185, 129, 0.1); padding: 20px; border-radius: var(--border-radius); border: 1px solid rgba(16, 185, 129, 0.3); margin-bottom: 24px;">
                                <p style="color: var(--light); font-family: var(--font-mono); font-size: 0.9rem; word-break: break-all;" id="orderIdDisplay"></p>
                            </div>
                            
                            <div class="form-group">
                                <button class="btn btn-primary btn-block" id="downloadInvoiceBtn">
                                    <i class="fas fa-download"></i> Preuzmi Fakturu (PDF)
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <button class="btn btn-outline btn-block" id="continueShoppingAfterCheckoutBtn">
                                    <i class="fas fa-shopping-cart"></i> Nastavi sa Kupovinom
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ===== MAIN CONTENT ===== -->
    <main id="mainContent" style="min-height: 80vh;">
        <!-- Home Page -->
        <section class="section" id="homePage" style="display: block;">
            <div class="container">
                <div class="hero">
                    <div class="hero-content">
                        <h1 class="hero-title">BALKAN GAMING EMPIRE</h1>
                        <p class="hero-description">
                            Najveći izbor video igara i gaming opreme na Balkanu. 
                            Premium kvalitet, najbolje cene i brza dostava.
                        </p>
                        
                        <div class="hero-actions">
                            <a href="#shop" class="btn btn-primary" data-page="shop">
                                <i class="fas fa-gamepad"></i> Istraži Shop
                            </a>
                            <button class="btn btn-secondary" id="exploreCategoriesBtn">
                                <i class="fas fa-th-large"></i> Kategorije
                            </button>
                        </div>
                    </div>
                    
                    <div class="hero-bg"></div>
                </div>
                
                <div class="section-header">
                    <h2>🔥 Popularne Igre</h2>
                    <p>Najtraženije igre ovog meseca</p>
                </div>
                
                <div class="products-grid" id="featuredProducts"></div>
            </div>
        </section>
        
        <!-- Shop Page -->
        <section class="section" id="shopPage" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <h2>🎮 Gaming Shop</h2>
                    <p>Pronađite savršenu igru za vas</p>
                </div>
                
                <div style="margin-bottom: 32px;">
                    <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 200px;">
                            <input type="text" class="form-control" id="searchProducts" placeholder="Pretraži igre...">
                        </div>
                        <div style="min-width: 150px;">
                            <select class="form-select" id="sortProducts">
                                <option value="name_asc">Naziv (A-Z)</option>
                                <option value="name_desc">Naziv (Z-A)</option>
                                <option value="price_asc">Cena (niža-viša)</option>
                                <option value="price_desc">Cena (viša-niža)</option>
                                <option value="newest">Najnovije</option>
                            </select>
                        </div>
                        <div style="min-width: 150px;">
                            <select class="form-select" id="filterCategory">
                                <option value="">Sve kategorije</option>
                                <option value="rpg">RPG</option>
                                <option value="fps">FPS</option>
                                <option value="strategy">Strategija</option>
                                <option value="sports">Sport</option>
                                <option value="adventure">Avantura</option>
                                <option value="indie">Indie</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="products-grid" id="allProducts"></div>
            </div>
        </section>
        
        <!-- Categories Page -->
        <section class="section" id="categoriesPage" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <h2>📁 Kategorije</h2>
                    <p>Pretražite igre po žanrovima</p>
                </div>
                
                <div class="products-grid" id="categoriesGrid">
                    <!-- Categories will be loaded here -->
                </div>
            </div>
        </section>
        
        <!-- Dashboard Page -->
        <section class="section" id="dashboardPage" style="display: none;">
            <div class="container">
                <div class="dashboard">
                    <div class="dashboard-sidebar">
                        <ul class="dashboard-nav">
                            <li class="dashboard-nav-item">
                                <a href="#" class="dashboard-nav-link active" data-dashboard-section="orders">
                                    <i class="fas fa-shopping-bag"></i> Moje Porudžbine
                                </a>
                            </li>
                            <li class="dashboard-nav-item">
                                <a href="#" class="dashboard-nav-link" data-dashboard-section="wishlist">
                                    <i class="fas fa-heart"></i> Lista Želja
                                </a>
                            </li>
                            <li class="dashboard-nav-item">
                                <a href="#" class="dashboard-nav-link" data-dashboard-section="profile">
                                    <i class="fas fa-user"></i> Moj Profil
                                </a>
                            </li>
                            <li class="dashboard-nav-item">
                                <a href="#" class="dashboard-nav-link" id="logoutBtn">
                                    <i class="fas fa-sign-out-alt"></i> Odjavi se
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="dashboard-content">
                        <!-- Orders Section -->
                        <div class="dashboard-section active" id="dashboardOrders">
                            <h3 style="margin-bottom: 24px;">Moje Porudžbine</h3>
                            <div class="table-responsive">
                                <table class="orders-table">
                                    <thead>
                                        <tr>
                                            <th>Broj Porudžbine</th>
                                            <th>Datum</th>
                                            <th>Status</th>
                                            <th>Ukupno</th>
                                            <th>Akcije</th>
                                        </tr>
                                    </thead>
                                    <tbody id="userOrdersTable">
                                        <!-- Orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Wishlist Section -->
                        <div class="dashboard-section" id="dashboardWishlist">
                            <h3 style="margin-bottom: 24px;">Moja Lista Želja</h3>
                            <div class="products-grid" id="userWishlist"></div>
                        </div>
                        
                        <!-- Profile Section -->
                        <div class="dashboard-section" id="dashboardProfile">
                            <h3 style="margin-bottom: 24px;">Moj Profil</h3>
                            <form id="profileForm">
                                <div class="form-group">
                                    <label class="form-label" for="profileName">Ime i Prezime</label>
                                    <input type="text" class="form-control" id="profileName" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="profileEmail">Email</label>
                                    <input type="email" class="form-control" id="profileEmail" required disabled>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="profilePhone">Telefon</label>
                                    <input type="tel" class="form-control" id="profilePhone" placeholder="+381 60 123 4567">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="profileAddress">Adresa</label>
                                    <textarea class="form-control form-textarea" id="profileAddress" placeholder="Ulica i broj, grad, poštanski broj"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Sačuvaj Promene
                                    </button>
                                </div>
                            </form>
                            
                            <div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                                <h4 style="margin-bottom: 16px;">Promena Lozinke</h4>
                                <form id="changePasswordForm">
                                    <div class="form-group">
                                        <label class="form-label" for="currentPassword">Trenutna Lozinka</label>
                                        <input type="password" class="form-control" id="currentPassword" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label" for="newPassword">Nova Lozinka</label>
                                        <input type="password" class="form-control" id="newPassword" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label" for="confirmNewPassword">Potvrdi Novu Lozinku</label>
                                        <input type="password" class="form-control" id="confirmNewPassword" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-secondary">
                                            <i class="fas fa-key"></i> Promeni Lozinku
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- ===== FOOTER ===== -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div>
                    <div class="footer-logo">
                        <i class="fas fa-gamepad"></i> BALKAN GAMING
                    </div>
                    <p class="footer-description">
                        Vodeći gaming e-commerce na Balkanu. 
                        Prodajemo samo originalne igre sa garancijom i podrškom.
                    </p>
                </div>
                
                <div>
                    <h4 class="footer-heading">Brzi Linkovi</h4>
                    <ul class="footer-links">
                        <li><a href="#home" class="footer-link" data-page="home">Početna</a></li>
                        <li><a href="#shop" class="footer-link" data-page="shop">Shop</a></li>
                        <li><a href="#categories" class="footer-link" data-page="categories">Kategorije</a></li>
                        <li><a href="#" class="footer-link" id="footerLoginBtn">Prijava</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="footer-heading">Kontakt</h4>
                    <ul class="footer-links">
                        <li><a href="mailto:info@balkan-gaming.com" class="footer-link">info@balkan-gaming.com</a></li>
                        <li><a href="tel:+381601234567" class="footer-link">+381 60 123 4567</a></li>
                        <li class="footer-link">Beograd, Srbija</li>
                        <li class="footer-link">Radno vreme: 24/7</li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="footer-heading">Pratite Nas</h4>
                    <ul class="footer-links">
                        <li><a href="#" class="footer-link"><i class="fab fa-facebook"></i> Facebook</a></li>
                        <li><a href="#" class="footer-link"><i class="fab fa-instagram"></i> Instagram</a></li>
                        <li><a href="#" class="footer-link"><i class="fab fa-twitter"></i> Twitter</a></li>
                        <li><a href="#" class="footer-link"><i class="fab fa-discord"></i> Discord</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2024 Balkan Gaming Empire. Sva prava zadržana.</p>
                <p style="margin-top: 8px; font-size: 0.8rem;">
                    <a href="#" style="color: var(--gray);">Uslovi korišćenja</a> | 
                    <a href="#" style="color: var(--gray);">Politika privatnosti</a> | 
                    <a href="#" style="color: var(--gray);">Reklamacije</a>
                </p>
            </div>
        </div>
    </footer>
    
    <!-- ===== TOAST NOTIFICATION ===== -->
    <div class="toast" id="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div id="toastMessage"></div>
    </div>
    
    <!-- ===== SCRIPT TAGS ===== -->
    <!-- ISPRAVLJENE VERZIJE SCRIPT TAGOVA -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/toastify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // UMD module for jsPDF
        window.jsPDF = window.jspdf.jsPDF;
    </script>
    
    <!-- ===== MAIN APPLICATION CODE ===== -->
    <script>
        (function() {
            'use strict';
            
            // ============================================
            // CONFIGURATION & CONSTANTS
            // ============================================
            const CONFIG = {
                APP_NAME: 'Balkan Gaming Empire',
                VERSION: '1.0.0',
                CURRENCY: 'RSD',
                TAX_RATE: 0.20, // 20% PDV
                SHIPPING_FEE: 299,
                FREE_SHIPPING_THRESHOLD: 5000,
                SESSION_TIMEOUT: 60 * 60 * 1000, // 1 hour in milliseconds
                MAX_LOGIN_ATTEMPTS: 5,
                RATE_LIMIT_WINDOW: 15 * 60 * 1000, // 15 minutes
                RATE_LIMIT_MAX_REQUESTS: 100,
                ENCRYPTION_KEY: 'balkan-gaming-secure-key-2024'
            };
            
            // ============================================
            // SECURITY UTILITIES
            // ============================================
            const Security = {
                // XSS Protection - Sanitize input
                sanitize: function(input) {
                    if (typeof input !== 'string') return input;
                    
                    const div = document.createElement('div');
                    div.textContent = input;
                    return div.innerHTML;
                },
                
                // Validate email format
                validateEmail: function(email) {
                    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return re.test(String(email).toLowerCase());
                },
                
                // Password strength validation
                validatePassword: function(password) {
                    const minLength = 8;
                    const hasUpperCase = /[A-Z]/.test(password);
                    const hasLowerCase = /[a-z]/.test(password);
                    const hasNumbers = /\d/.test(password);
                    const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);
                    
                    return {
                        isValid: password.length >= minLength && hasUpperCase && hasLowerCase && hasNumbers,
                        errors: {
                            length: password.length >= minLength ? null : `Lozinka mora imati najmanje ${minLength} karaktera`,
                            upperCase: hasUpperCase ? null : 'Lozinka mora sadržati barem jedno veliko slovo',
                            lowerCase: hasLowerCase ? null : 'Lozinka mora sadržati barem jedno malo slovo',
                            numbers: hasNumbers ? null : 'Lozinka mora sadržati barem jedan broj',
                            specialChar: hasSpecialChar ? null : 'Preporučujemo dodavanje specijalnog karaktera'
                        }
                    };
                },
                
                // Simple encryption for sensitive data (not for production, use proper crypto in real apps)
                encrypt: function(text) {
                    try {
                        let result = '';
                        for (let i = 0; i < text.length; i++) {
                            const charCode = text.charCodeAt(i) ^ CONFIG.ENCRYPTION_KEY.charCodeAt(i % CONFIG.ENCRYPTION_KEY.length);
                            result += String.fromCharCode(charCode);
                        }
                        return btoa(result);
                    } catch (error) {
                        console.error('Encryption error:', error);
                        return text;
                    }
                },
                
                // Simple decryption
                decrypt: function(encryptedText) {
                    try {
                        const text = atob(encryptedText);
                        let result = '';
                        for (let i = 0; i < text.length; i++) {
                            const charCode = text.charCodeAt(i) ^ CONFIG.ENCRYPTION_KEY.charCodeAt(i % CONFIG.ENCRYPTION_KEY.length);
                            result += String.fromCharCode(charCode);
                        }
                        return result;
                    } catch (error) {
                        console.error('Decryption error:', error);
                        return encryptedText;
                    }
                },
                
                // Generate CSRF token
                generateCSRFToken: function() {
                    const array = new Uint8Array(32);
                    window.crypto.getRandomValues(array);
                    return Array.from(array, byte => byte.toString(16).padStart(2, '0')).join('');
                },
                
                // Hash password (simplified - use bcrypt in production)
                hashPassword: function(password) {
                    let hash = 0;
                    for (let i = 0; i < password.length; i++) {
                        const char = password.charCodeAt(i);
                        hash = ((hash << 5) - hash) + char;
                        hash = hash & hash;
                    }
                    return Math.abs(hash).toString(16);
                },
                
                // Rate limiting
                rateLimit: {
                    requests: {},
                    isAllowed: function(ip) {
                        const now = Date.now();
                        if (!this.requests[ip]) {
                            this.requests[ip] = [];
                        }
                        
                        // Clean old requests
                        this.requests[ip] = this.requests[ip].filter(time => now - time < CONFIG.RATE_LIMIT_WINDOW);
                        
                        // Check if under limit
                        if (this.requests[ip].length < CONFIG.RATE_LIMIT_MAX_REQUESTS) {
                            this.requests[ip].push(now);
                            return true;
                        }
                        
                        return false;
                    }
                }
            };
            
            // ============================================
            // STORAGE MANAGEMENT
            // ============================================
            const Storage = {
                // Secure localStorage with encryption for sensitive data
                setItem: function(key, value, encrypt = false) {
                    try {
                        const data = encrypt ? Security.encrypt(JSON.stringify(value)) : JSON.stringify(value);
                        localStorage.setItem(key, data);
                        return true;
                    } catch (error) {
                        console.error('Storage set error:', error);
                        this.showError('Greška pri čuvanju podataka');
                        return false;
                    }
                },
                
                getItem: function(key, decrypt = false) {
                    try {
                        const data = localStorage.getItem(key);
                        if (!data) return null;
                        
                        return decrypt ? JSON.parse(Security.decrypt(data)) : JSON.parse(data);
                    } catch (error) {
                        console.error('Storage get error:', error);
                        return null;
                    }
                },
                
                removeItem: function(key) {
                    try {
                        localStorage.removeItem(key);
                        return true;
                    } catch (error) {
                        console.error('Storage remove error:', error);
                        return false;
                    }
                },
                
                clear: function() {
                    try {
                        localStorage.clear();
                        return true;
                    } catch (error) {
                        console.error('Storage clear error:', error);
                        return false;
                    }
                },
                
                // Cart specific methods
                getCart: function() {
                    const cart = this.getItem('bge_cart') || { items: [], subtotal: 0, tax: 0, shipping: 0, total: 0 };
                    this.updateCartTotals(cart);
                    return cart;
                },
                
                saveCart: function(cart) {
                    this.updateCartTotals(cart);
                    return this.setItem('bge_cart', cart);
                },
                
                updateCartTotals: function(cart) {
                    cart.subtotal = cart.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                    cart.tax = cart.subtotal * CONFIG.TAX_RATE;
                    cart.shipping = cart.subtotal >= CONFIG.FREE_SHIPPING_THRESHOLD ? 0 : CONFIG.SHIPPING_FEE;
                    cart.total = cart.subtotal + cart.tax + cart.shipping;
                },
                
                // User session management
                getSession: function() {
                    return this.getItem('bge_session', true);
                },
                
                saveSession: function(session) {
                    session.lastActivity = Date.now();
                    return this.setItem('bge_session', session, true);
                },
                
                clearSession: function() {
                    this.removeItem('bge_session');
                },
                
                // Products management
                getProducts: function() {
                    return this.getItem('bge_products') || this.getDefaultProducts();
                },
                
                saveProduct: function(product) {
                    const products = this.getProducts();
                    product.id = product.id || Date.now().toString();
                    product.createdAt = product.createdAt || new Date().toISOString();
                    product.updatedAt = new Date().toISOString();
                    
                    const existingIndex = products.findIndex(p => p.id === product.id);
                    if (existingIndex >= 0) {
                        products[existingIndex] = product;
                    } else {
                        products.push(product);
                    }
                    
                    return this.setItem('bge_products', products);
                },
                
                deleteProduct: function(productId) {
                    const products = this.getProducts();
                    const filteredProducts = products.filter(p => p.id !== productId);
                    return this.setItem('bge_products', filteredProducts);
                },
                
                // Orders management
                getOrders: function() {
                    return this.getItem('bge_orders') || [];
                },
                
                saveOrder: function(order) {
                    const orders = this.getOrders();
                    order.id = order.id || `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 9).toUpperCase()}`;
                    order.createdAt = order.createdAt || new Date().toISOString();
                    order.status = order.status || 'pending';
                    
                    orders.push(order);
                    this.setItem('bge_orders', orders);
                    
                    // Send email notifications (simulated)
                    this.sendOrderEmail(order);
                    
                    return order.id;
                },
                
                updateOrderStatus: function(orderId, status) {
                    const orders = this.getOrders();
                    const orderIndex = orders.findIndex(o => o.id === orderId);
                    
                    if (orderIndex >= 0) {
                        orders[orderIndex].status = status;
                        orders[orderIndex].updatedAt = new Date().toISOString();
                        this.setItem('bge_orders', orders);
                        return true;
                    }
                    
                    return false;
                },
                
                // Users management
                getUsers: function() {
                    return this.getItem('bge_users', true) || [];
                },
                
                saveUser: function(user) {
                    const users = this.getUsers();
                    user.id = user.id || `USR-${Date.now()}`;
                    user.createdAt = user.createdAt || new Date().toISOString();
                    user.updatedAt = new Date().toISOString();
                    
                    // Hash password before saving
                    if (user.password) {
                        user.passwordHash = Security.hashPassword(user.password);
                        delete user.password;
                    }
                    
                    const existingIndex = users.findIndex(u => u.email === user.email);
                    if (existingIndex >= 0) {
                        users[existingIndex] = { ...users[existingIndex], ...user };
                    } else {
                        users.push(user);
                    }
                    
                    return this.setItem('bge_users', users, true);
                },
                
                authenticateUser: function(email, password) {
                    const users = this.getUsers();
                    const user = users.find(u => u.email === email);
                    
                    if (!user) return null;
                    
                    if (user.passwordHash === Security.hashPassword(password)) {
                        // Update last login
                        user.lastLogin = new Date().toISOString();
                        user.loginAttempts = 0;
                        this.saveUser(user);
                        
                        // Create session
                        const session = {
                            userId: user.id,
                            email: user.email,
                            name: user.name,
                            role: user.role || 'user',
                            createdAt: new Date().toISOString(),
                            lastActivity: Date.now()
                        };
                        
                        this.saveSession(session);
                        return session;
                    } else {
                        // Increment failed attempts
                        user.loginAttempts = (user.loginAttempts || 0) + 1;
                        this.saveUser(user);
                        return null;
                    }
                },
                
                // Wishlist management
                getWishlist: function() {
                    const session = this.getSession();
                    if (!session) return [];
                    
                    const wishlists = this.getItem('bge_wishlists') || {};
                    return wishlists[session.userId] || [];
                },
                
                saveWishlist: function(items) {
                    const session = this.getSession();
                    if (!session) return false;
                    
                    const wishlists = this.getItem('bge_wishlists') || {};
                    wishlists[session.userId] = items;
                    return this.setItem('bge_wishlists', wishlists);
                },
                
                // Email simulation (in production, use EmailJS, SendGrid, etc.)
                sendOrderEmail: function(order) {
                    // Simulate email sending
                    console.log('Sending order confirmation email to:', order.customer.email);
                    console.log('Order details:', {
                        orderId: order.id,
                        total: order.total,
                        items: order.items.length
                    });
                    
                    // In a real app, you would:
                    // 1. Use EmailJS: emailjs.send(service_id, template_id, template_params)
                    // 2. Or SendGrid: sgMail.send(msg)
                    // 3. Or SMTP: nodemailer.createTransport().sendMail()
                    
                    // For demo purposes, we'll just log it
                    const emailContent = `
                        Nova porudžbina primljena!
                        
                        Broj porudžbine: ${order.id}
                        Kupac: ${order.customer.name}
                        Email: ${order.customer.email}
                        Ukupno: ${order.total} ${CONFIG.CURRENCY}
                        
                        Stavke:
                        ${order.items.map(item => `- ${item.title} x${item.quantity}: ${item.price * item.quantity} ${CONFIG.CURRENCY}`).join('\n')}
                        
                        Adresa isporuke:
                        ${order.customer.address}
                        
                        Status: ${order.status}
                    `;
                    
                    console.log('Admin notification:', emailContent);
                },
                
                // Get default products if none exist
                getDefaultProducts: function() {
                    const defaultProducts = [
                        {
                            id: '1',
                            title: 'Cyberpunk 2077: Phantom Liberty',
                            description: 'Najnovije proširenje za kultni Cyberpunk 2077. Nova lokacija, priča i misije.',
                            price: 4499,
                            category: 'rpg',
                            platform: 'PC',
                            developer: 'CD Projekt Red',
                            releaseDate: '2023-09-26',
                            rating: 4.5,
                            stock: 25,
                            tags: ['RPG', 'Open World', 'Cyberpunk'],
                            image: 'game1',
                            featured: true
                        },
                        {
                            id: '2',
                            title: 'Elden Ring: Shadow of the Erdtree',
                            description: 'Ogromno DLC za Elden Ring sa novim regijama, bossovima i oružjima.',
                            price: 5999,
                            category: 'rpg',
                            platform: 'Multi',
                            developer: 'FromSoftware',
                            releaseDate: '2024-06-21',
                            rating: 4.8,
                            stock: 18,
                            tags: ['RPG', 'Souls-like', 'Fantasy'],
                            image: 'game2',
                            featured: true
                        },
                        {
                            id: '3',
                            title: 'Counter-Strike 2',
                            description: 'Besplatni competitive FPS sa najboljom mehanikom i balanced gameplay-om.',
                            price: 0,
                            category: 'fps',
                            platform: 'PC',
                            developer: 'Valve',
                            releaseDate: '2023-09-27',
                            rating: 4.7,
                            stock: 999,
                            tags: ['FPS', 'Competitive', 'Free'],
                            image: 'game3',
                            featured: true
                        },
                        {
                            id: '4',
                            title: 'FIFA 24 - Ultimate Edition',
                            description: 'Najnovija verzija popularne fudbalske simulacije sa svim timovima i ligama.',
                            price: 6499,
                            category: 'sports',
                            platform: 'Multi',
                            developer: 'EA Sports',
                            releaseDate: '2023-09-29',
                            rating: 4.3,
                            stock: 32,
                            tags: ['Sports', 'Football', 'Simulation'],
                            image: 'game4',
                            featured: false
                        },
                        {
                            id: '5',
                            title: 'Baldur\'s Gate 3',
                            description: 'Epic RPG sa D&D mehanikom, izborima koji utiču na priču i bogatim svetom.',
                            price: 5299,
                            category: 'rpg',
                            platform: 'PC',
                            developer: 'Larian Studios',
                            releaseDate: '2023-08-03',
                            rating: 4.9,
                            stock: 21,
                            tags: ['RPG', 'D&D', 'Story Rich'],
                            image: 'game5',
                            featured: true
                        },
                        {
                            id: '6',
                            title: 'Call of Duty: Modern Warfare III',
                            description: 'Nastavak popularne FPS serije sa novim mapama, oružjima i campaign-om.',
                            price: 6999,
                            category: 'fps',
                            platform: 'Multi',
                            developer: 'Activision',
                            releaseDate: '2023-11-10',
                            rating: 4.2,
                            stock: 28,
                            tags: ['FPS', 'Action', 'Military'],
                            image: 'game6',
                            featured: false
                        },
                        {
                            id: '7',
                            title: 'The Legend of Zelda: Tears of the Kingdom',
                            description: 'Nastavak Breath of the Wild sa novim abilities i ogromnim svetom za istraživanje.',
                            price: 7499,
                            category: 'adventure',
                            platform: 'Switch',
                            developer: 'Nintendo',
                            releaseDate: '2023-05-12',
                            rating: 4.8,
                            stock: 15,
                            tags: ['Adventure', 'Open World', 'Nintendo'],
                            image: 'game7',
                            featured: true
                        },
                        {
                            id: '8',
                            title: 'Starfield',
                            description: 'Space RPG od kreatora Fallout-a sa 1000+ planeti za istraživanje.',
                            price: 4999,
                            category: 'rpg',
                            platform: 'PC/Xbox',
                            developer: 'Bethesda',
                            releaseDate: '2023-09-06',
                            rating: 4.4,
                            stock: 23,
                            tags: ['RPG', 'Space', 'Exploration'],
                            image: 'game8',
                            featured: false
                        }
                    ];
                    
                    this.setItem('bge_products', defaultProducts);
                    return defaultProducts;
                }
            };
            
            // ============================================
            // UI UTILITIES
            // ============================================
            const UI = {
                // Show toast notification
                showToast: function(message, type = 'info', duration = 3000) {
                    const toast = document.getElementById('toast');
                    const toastMessage = document.getElementById('toastMessage');
                    
                    if (!toast || !toastMessage) return;
                    
                    // Set message and type
                    toastMessage.textContent = message;
                    toast.className = 'toast';
                    toast.classList.add(`toast-${type}`);
                    
                    // Show toast
                    toast.classList.add('show');
                    
                    // Auto hide
                    setTimeout(() => {
                        toast.classList.remove('show');
                    }, duration);
                    
                    // Accessibility
                    toast.setAttribute('aria-label', message);
                },
                
                // Show error message in form
                showFormError: function(elementId, message) {
                    const errorElement = document.getElementById(elementId);
                    if (errorElement) {
                        errorElement.textContent = message;
                        errorElement.classList.add('show');
                    }
                },
                
                // Clear form errors
                clearFormErrors: function(formId) {
                    const form = document.getElementById(formId);
                    if (form) {
                        const errors = form.querySelectorAll('.form-error');
                        errors.forEach(error => {
                            error.textContent = '';
                            error.classList.remove('show');
                        });
                    }
                },
                
                // Format currency
                formatCurrency: function(amount) {
                    return new Intl.NumberFormat('sr-RS', {
                        style: 'currency',
                        currency: 'RSD',
                        minimumFractionDigits: 0
                    }).format(amount);
                },
                
                // Format date
                formatDate: function(dateString) {
                    const date = new Date(dateString);
                    return new Intl.DateTimeFormat('sr-RS', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }).format(date);
                },
                
                // Toggle loading state
                toggleLoading: function(element, isLoading) {
                    if (!element) return;
                    
                    if (isLoading) {
                        element.disabled = true;
                        const originalText = element.innerHTML;
                        element.setAttribute('data-original-text', originalText);
                        element.innerHTML = '<span class="spinner"></span> Učitavanje...';
                    } else {
                        element.disabled = false;
                        const originalText = element.getAttribute('data-original-text');
                        if (originalText) {
                            element.innerHTML = originalText;
                            element.removeAttribute('data-original-text');
                        }
                    }
                },
                
                // Update cart badge
                updateCartBadge: function() {
                    const cart = Storage.getCart();
                    const badge = document.getElementById('cartBadge');
                    if (badge) {
                        const totalItems = cart.items.reduce((sum, item) => sum + item.quantity, 0);
                        badge.textContent = totalItems;
                        badge.style.display = totalItems > 0 ? 'flex' : 'none';
                    }
                },
                
                // Update wishlist badge
                updateWishlistBadge: function() {
                    const wishlist = Storage.getWishlist();
                    const badge = document.getElementById('wishlistBadge');
                    if (badge) {
                        badge.textContent = wishlist.length;
                        badge.style.display = wishlist.length > 0 ? 'flex' : 'none';
                    }
                },
                
                // Render product card
                renderProductCard: function(product) {
                    const isInWishlist = Storage.getWishlist().some(item => item.id === product.id);
                    
                    return `
                        <div class="product-card" data-product-id="${product.id}">
                            <div class="card">
                                <div class="product-image">
                                    <span class="product-badge badge badge-primary">${product.category.toUpperCase()}</span>
                                    ${product.featured ? '<span class="badge badge-success" style="position: absolute; top: 12px; right: 12px;">FEATURED</span>' : ''}
                                </div>
                                
                                <h3 class="product-title">${Security.sanitize(product.title)}</h3>
                                <p class="product-description">${Security.sanitize(product.description)}</p>
                                
                                <div class="product-price">
                                    ${product.price === 0 ? 'BESPLATNO' : UI.formatCurrency(product.price)}
                                </div>
                                
                                <div class="product-actions">
                                    <button class="btn btn-primary btn-small add-to-cart-btn" data-product-id="${product.id}">
                                        <i class="fas fa-cart-plus"></i> ${product.price === 0 ? 'PREUZMI' : 'DODAJ'}
                                    </button>
                                    <button class="btn btn-outline btn-small toggle-wishlist-btn ${isInWishlist ? 'active' : ''}" data-product-id="${product.id}">
                                        <i class="fas ${isInWishlist ? 'fa-heart' : 'fa-heart'}"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                },
                
                // Render cart item
                renderCartItem: function(item) {
                    return `
                        <div class="cart-item" data-item-id="${item.id}">
                            <div class="cart-item-image"></div>
                            <div class="cart-item-content">
                                <div class="cart-item-title">${Security.sanitize(item.title)}</div>
                                <div class="cart-item-price">${UI.formatCurrency(item.price)}</div>
                                <div class="cart-item-actions">
                                    <div class="cart-item-quantity">
                                        <button class="cart-item-quantity-btn decrease-quantity" data-item-id="${item.id}">-</button>
                                        <span class="cart-item-quantity-value">${item.quantity}</span>
                                        <button class="cart-item-quantity-btn increase-quantity" data-item-id="${item.id}">+</button>
                                    </div>
                                    <button class="cart-item-remove remove-from-cart" data-item-id="${item.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                },
                
                // Update cart display
                updateCartDisplay: function() {
                    const cart = Storage.getCart();
                    const cartItems = document.getElementById('cartItems');
                    const cartEmpty = document.getElementById('cartEmpty');
                    const cartFooter = document.getElementById('cartFooter');
                    const cartTotalValue = document.getElementById('cartTotalValue');
                    
                    if (cart.items.length === 0) {
                        cartItems.style.display = 'none';
                        cartEmpty.style.display = 'block';
                        cartFooter.style.display = 'none';
                    } else {
                        cartItems.style.display = 'block';
                        cartEmpty.style.display = 'none';
                        cartFooter.style.display = 'block';
                        
                        // Render items
                        cartItems.innerHTML = cart.items.map(item => this.renderCartItem(item)).join('');
                        
                        // Update total
                        if (cartTotalValue) {
                            cartTotalValue.textContent = UI.formatCurrency(cart.total);
                        }
                    }
                    
                    // Update badge
                    this.updateCartBadge();
                },
                
                // Update wishlist display
                updateWishlistDisplay: function() {
                    const wishlist = Storage.getWishlist();
                    const wishlistItems = document.getElementById('wishlistItems');
                    const wishlistEmpty = document.getElementById('wishlistEmpty');
                    const products = Storage.getProducts();
                    
                    if (wishlist.length === 0) {
                        wishlistItems.style.display = 'none';
                        wishlistEmpty.style.display = 'block';
                    } else {
                        wishlistItems.style.display = 'block';
                        wishlistEmpty.style.display = 'none';
                        
                        // Filter products that are in wishlist
                        const wishlistProducts = products.filter(p => 
                            wishlist.some(w => w.id === p.id)
                        );
                        
                        // Render items
                        wishlistItems.innerHTML = wishlistProducts.map(product => `
                            <div class="cart-item" data-item-id="${product.id}">
                                <div class="cart-item-image"></div>
                                <div class="cart-item-content">
                                    <div class="cart-item-title">${Security.sanitize(product.title)}</div>
                                    <div class="cart-item-price">${UI.formatCurrency(product.price)}</div>
                                    <div class="cart-item-actions">
                                        <button class="btn btn-primary btn-small add-to-cart-from-wishlist" data-product-id="${product.id}">
                                            <i class="fas fa-cart-plus"></i> Dodaj u Korpu
                                        </button>
                                        <button class="cart-item-remove remove-from-wishlist" data-product-id="${product.id}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('');
                    }
                    
                    // Update badge
                    this.updateWishlistBadge();
                },
                
                // Generate PDF invoice
                generateInvoice: function(order) {
                    try {
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF();
                        
                        // Add logo/header
                        doc.setFontSize(20);
                        doc.text('BALKAN GAMING EMPIRE', 105, 20, { align: 'center' });
                        doc.setFontSize(12);
                        doc.text('FAKTURA', 105, 30, { align: 'center' });
                        
                        // Order info
                        doc.setFontSize(10);
                        doc.text(`Broj fakture: ${order.id}`, 20, 50);
                        doc.text(`Datum: ${UI.formatDate(order.createdAt)}`, 20, 57);
                        
                        // Customer info
                        doc.text('Kupac:', 20, 70);
                        doc.text(order.customer.name, 20, 77);
                        doc.text(order.customer.email, 20, 84);
                        doc.text(order.customer.phone, 20, 91);
                        doc.text(order.customer.address.split('\n')[0], 20, 98);
                        
                        // Items table
                        let y = 120;
                        doc.setFontSize(9);
                        doc.text('Rb', 20, y);
                        doc.text('Proizvod', 30, y);
                        doc.text('Količina', 120, y);
                        doc.text('Cena', 140, y);
                        doc.text('Ukupno', 170, y);
                        
                        y += 7;
                        doc.line(20, y, 190, y);
                        y += 7;
                        
                        order.items.forEach((item, index) => {
                            doc.text((index + 1).toString(), 20, y);
                            doc.text(item.title.substring(0, 40), 30, y);
                            doc.text(item.quantity.toString(), 120, y);
                            doc.text(UI.formatCurrency(item.price), 140, y);
                            doc.text(UI.formatCurrency(item.price * item.quantity), 170, y);
                            y += 7;
                        });
                        
                        // Totals
                        y += 10;
                        doc.text('Svega:', 140, y);
                        doc.text(UI.formatCurrency(order.subtotal), 170, y);
                        
                        y += 7;
                        doc.text('PDV (20%):', 140, y);
                        doc.text(UI.formatCurrency(order.tax), 170, y);
                        
                        y += 7;
                        doc.text('Dostava:', 140, y);
                        doc.text(UI.formatCurrency(order.shipping), 170, y);
                        
                        y += 7;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'bold');
                        doc.text('UKUPNO:', 140, y);
                        doc.text(UI.formatCurrency(order.total), 170, y);
                        
                        // Footer
                        y += 20;
                        doc.setFontSize(8);
                        doc.setFont(undefined, 'normal');
                        doc.text('Hvala na kupovini!', 105, y, { align: 'center' });
                        y += 5;
                        doc.text('Balkan Gaming Empire | info@balkan-gaming.com | +381 60 123 4567', 105, y, { align: 'center' });
                        
                        // Save PDF
                        doc.save(`faktura-${order.id}.pdf`);
                        UI.showToast('Faktura preuzeta!', 'success');
                        
                    } catch (error) {
                        console.error('PDF generation error:', error);
                        UI.showToast('Greška pri generisanju fakture', 'error');
                    }
                },
                
                // Update admin statistics
                updateAdminStats: function() {
                    const products = Storage.getProducts();
                    const orders = Storage.getOrders();
                    const users = Storage.getUsers();
                    
                    // Calculate total revenue
                    const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
                    
                    // Update DOM
                    const totalProducts = document.getElementById('adminTotalProducts');
                    const totalOrders = document.getElementById('adminTotalOrders');
                    const totalRevenueElem = document.getElementById('adminTotalRevenue');
                    const totalUsers = document.getElementById('adminTotalUsers');
                    
                    if (totalProducts) totalProducts.textContent = products.length;
                    if (totalOrders) totalOrders.textContent = orders.length;
                    if (totalRevenueElem) totalRevenueElem.textContent = UI.formatCurrency(totalRevenue);
                    if (totalUsers) totalUsers.textContent = users.length;
                }
            };
            
            // ============================================
            // APPLICATION STATE MANAGEMENT
            // ============================================
            const AppState = {
                currentPage: 'home',
                currentUser: null,
                cart: Storage.getCart(),
                wishlist: Storage.getWishlist(),
                products: Storage.getProducts(),
                orders: Storage.getOrders(),
                users: Storage.getUsers(),
                
                // Initialize application
                init: function() {
                    this.loadCurrentUser();
                    this.setupEventListeners();
                    this.renderFeaturedProducts();
                    this.renderAllProducts();
                    this.renderCategories();
                    this.checkSession();
                    this.setupTheme();
                    
                    // Update UI
                    UI.updateCartDisplay();
                    UI.updateWishlistDisplay();
                    UI.updateAdminStats();
                    
                    // Check for admin user
                    this.checkAdminUser();
                    
                    UI.showToast('Dobrodošli u Balkan Gaming Empire!', 'success', 2000);
                },
                
                // Load current user from session
                loadCurrentUser: function() {
                    const session = Storage.getSession();
                    if (session && this.isSessionValid(session)) {
                        this.currentUser = session;
                        this.updateUserUI(true);
                    } else {
                        Storage.clearSession();
                        this.currentUser = null;
                        this.updateUserUI(false);
                    }
                },
                
                // Check if session is still valid
                isSessionValid: function(session) {
                    if (!session || !session.lastActivity) return false;
                    
                    const now = Date.now();
                    const lastActivity = session.lastActivity;
                    const sessionAge = now - lastActivity;
                    
                    return sessionAge < CONFIG.SESSION_TIMEOUT;
                },
                
                // Update session activity
                updateSessionActivity: function() {
                    if (this.currentUser) {
                        this.currentUser.lastActivity = Date.now();
                        Storage.saveSession(this.currentUser);
                    }
                },
                
                // Check session periodically
                checkSession: function() {
                    setInterval(() => {
                        if (this.currentUser && !this.isSessionValid(this.currentUser)) {
                            this.logout();
                            UI.showToast('Sesija je istekla. Prijavite se ponovo.', 'warning');
                        }
                    }, 60000); // Check every minute
                },
                
                // Update UI based on login state
                updateUserUI: function(isLoggedIn) {
                    const userToggle = document.getElementById('userToggle');
                    const dashboardNav = document.getElementById('dashboardNav');
                    const adminToggle = document.getElementById('adminToggle');
                    
                    if (userToggle) {
                        if (isLoggedIn) {
                            userToggle.innerHTML = '<i class="fas fa-user-check"></i>';
                            userToggle.setAttribute('aria-label', 'Moj nalog');
                            
                            if (dashboardNav) {
                                dashboardNav.style.display = 'block';
                            }
                            
                            // Show admin toggle if user is admin
                            if (this.currentUser && this.currentUser.role === 'admin') {
                                if (adminToggle) {
                                    adminToggle.style.display = 'flex';
                                }
                            }
                        } else {
                            userToggle.innerHTML = '<i class="fas fa-user"></i>';
                            userToggle.setAttribute('aria-label', 'Prijava');
                            
                            if (dashboardNav) {
                                dashboardNav.style.display = 'none';
                            }
                            
                            if (adminToggle) {
                                adminToggle.style.display = 'none';
                            }
                        }
                    }
                },
                
                // Login user
                login: function(email, password) {
                    // Rate limiting check
                    const ip = 'user-' + email; // Simplified IP for demo
                    if (!Security.rateLimit.isAllowed(ip)) {
                        UI.showToast('Previše pokušaja prijave. Pokušajte kasnije.', 'error');
                        return false;
                    }
                    
                    // Validate input
                    if (!email || !password) {
                        UI.showToast('Unesite email i lozinku', 'error');
                        return false;
                    }
                    
                    if (!Security.validateEmail(email)) {
                        UI.showToast('Unesite validan email', 'error');
                        return false;
                    }
                    
                    // Authenticate
                    const session = Storage.authenticateUser(email, password);
                    
                    if (session) {
                        this.currentUser = session;
                        this.updateUserUI(true);
                        UI.showToast('Uspešno prijavljeni!', 'success');
                        this.closeModal('loginModal');
                        return true;
                    } else {
                        UI.showToast('Pogrešan email ili lozinka', 'error');
                        return false;
                    }
                },
                
                // Register user
                register: function(userData) {
                    // Validate input
                    if (!userData.name || !userData.email || !userData.password || !userData.confirmPassword) {
                        UI.showToast('Popunite sva polja', 'error');
                        return false;
                    }
                    
                    if (!Security.validateEmail(userData.email)) {
                        UI.showToast('Unesite validan email', 'error');
                        return false;
                    }
                    
                    const passwordValidation = Security.validatePassword(userData.password);
                    if (!passwordValidation.isValid) {
                        UI.showToast('Lozinka nije dovoljno jaka', 'error');
                        return false;
                    }
                    
                    if (userData.password !== userData.confirmPassword) {
                        UI.showToast('Lozinke se ne poklapaju', 'error');
                        return false;
                    }
                    
                    // Check if user exists
                    const users = Storage.getUsers();
                    if (users.some(u => u.email === userData.email)) {
                        UI.showToast('Korisnik sa ovim email-om već postoji', 'error');
                        return false;
                    }
                    
                    // Create user
                    const newUser = {
                        name: Security.sanitize(userData.name),
                        email: userData.email,
                        password: userData.password,
                        role: 'user',
                        createdAt: new Date().toISOString()
                    };
                    
                    if (Storage.saveUser(newUser)) {
                        // Auto login
                        this.login(userData.email, userData.password);
                        UI.showToast('Uspešno ste registrovani!', 'success');
                        this.closeModal('registerModal');
                        return true;
                    } else {
                        UI.showToast('Greška pri registraciji', 'error');
                        return false;
                    }
                },
                
                // Logout user
                logout: function() {
                    Storage.clearSession();
                    this.currentUser = null;
                    this.updateUserUI(false);
                    this.navigateTo('home');
                    UI.showToast('Uspešno ste odjavljeni', 'success');
                },
                
                // Update user profile
                updateProfile: function(profileData) {
                    if (!this.currentUser) return false;
                    
                    const users = Storage.getUsers();
                    const userIndex = users.findIndex(u => u.id === this.currentUser.userId);
                    
                    if (userIndex >= 0) {
                        users[userIndex] = {
                            ...users[userIndex],
                            name: Security.sanitize(profileData.name) || users[userIndex].name,
                            phone: Security.sanitize(profileData.phone) || users[userIndex].phone,
                            address: Security.sanitize(profileData.address) || users[userIndex].address,
                            updatedAt: new Date().toISOString()
                        };
                        
                        if (Storage.setItem('bge_users', users, true)) {
                            // Update session
                            this.currentUser.name = users[userIndex].name;
                            Storage.saveSession(this.currentUser);
                            
                            UI.showToast('Profil uspešno ažuriran!', 'success');
                            return true;
                        }
                    }
                    
                    UI.showToast('Greška pri ažuriranju profila', 'error');
                    return false;
                },
                
                // Change password
                changePassword: function(passwordData) {
                    if (!this.currentUser) return false;
                    
                    const users = Storage.getUsers();
                    const userIndex = users.findIndex(u => u.id === this.currentUser.userId);
                    
                    if (userIndex >= 0) {
                        // Verify current password
                        if (users[userIndex].passwordHash !== Security.hashPassword(passwordData.currentPassword)) {
                            UI.showToast('Trenutna lozinka nije ispravna', 'error');
                            return false;
                        }
                        
                        // Validate new password
                        const passwordValidation = Security.validatePassword(passwordData.newPassword);
                        if (!passwordValidation.isValid) {
                            UI.showToast('Nova lozinka nije dovoljno jaka', 'error');
                            return false;
                        }
                        
                        if (passwordData.newPassword !== passwordData.confirmNewPassword) {
                            UI.showToast('Nove lozinke se ne poklapaju', 'error');
                            return false;
                        }
                        
                        // Update password
                        users[userIndex].passwordHash = Security.hashPassword(passwordData.newPassword);
                        users[userIndex].updatedAt = new Date().toISOString();
                        
                        if (Storage.setItem('bge_users', users, true)) {
                            UI.showToast('Lozinka uspešno promenjena!', 'success');
                            return true;
                        }
                    }
                    
                    UI.showToast('Greška pri promeni lozinke', 'error');
                    return false;
                },
                
                // Add product to cart
                addToCart: function(productId, quantity = 1) {
                    const products = this.products;
                    const product = products.find(p => p.id === productId);
                    
                    if (!product) {
                        UI.showToast('Proizvod nije pronađen', 'error');
                        return false;
                    }
                    
                    if (product.stock < quantity) {
                        UI.showToast('Nema dovoljno proizvoda na stanju', 'error');
                        return false;
                    }
                    
                    const cart = this.cart;
                    const existingItemIndex = cart.items.findIndex(item => item.id === productId);
                    
                    if (existingItemIndex >= 0) {
                        // Update quantity
                        cart.items[existingItemIndex].quantity += quantity;
                    } else {
                        // Add new item
                        cart.items.push({
                            id: product.id,
                            title: product.title,
                            price: product.price,
                            quantity: quantity,
                            image: product.image
                        });
                    }
                    
                    // Update stock (in real app, this would be on backend)
                    product.stock -= quantity;
                    Storage.saveProduct(product);
                    this.products = Storage.getProducts();
                    
                    // Save cart
                    Storage.saveCart(cart);
                    this.cart = cart;
                    
                    // Update UI
                    UI.updateCartDisplay();
                    UI.showToast('Proizvod dodat u korpu!', 'success');
                    
                    return true;
                },
                
                // Remove from cart
                removeFromCart: function(productId) {
                    const cart = this.cart;
                    const itemIndex = cart.items.findIndex(item => item.id === productId);
                    
                    if (itemIndex >= 0) {
                        const removedItem = cart.items[itemIndex];
                        
                        // Restore stock
                        const products = this.products;
                        const product = products.find(p => p.id === productId);
                        if (product) {
                            product.stock += removedItem.quantity;
                            Storage.saveProduct(product);
                            this.products = Storage.getProducts();
                        }
                        
                        // Remove from cart
                        cart.items.splice(itemIndex, 1);
                        Storage.saveCart(cart);
                        this.cart = cart;
                        
                        // Update UI
                        UI.updateCartDisplay();
                        UI.showToast('Proizvod uklonjen iz korpe', 'success');
                        
                        return true;
                    }
                    
                    return false;
                },
                
                // Update cart quantity
                updateCartQuantity: function(productId, change) {
                    const cart = this.cart;
                    const itemIndex = cart.items.findIndex(item => item.id === productId);
                    
                    if (itemIndex >= 0) {
                        const newQuantity = cart.items[itemIndex].quantity + change;
                        
                        if (newQuantity < 1) {
                            this.removeFromCart(productId);
                            return;
                        }
                        
                        // Check stock
                        const products = this.products;
                        const product = products.find(p => p.id === productId);
                        
                        if (product && newQuantity > product.stock + cart.items[itemIndex].quantity) {
                            UI.showToast('Nema dovoljno proizvoda na stanju', 'error');
                            return;
                        }
                        
                        // Update stock
                        if (product) {
                            product.stock -= change;
                            Storage.saveProduct(product);
                            this.products = Storage.getProducts();
                        }
                        
                        // Update quantity
                        cart.items[itemIndex].quantity = newQuantity;
                        Storage.saveCart(cart);
                        this.cart = cart;
                        
                        // Update UI
                        UI.updateCartDisplay();
                    }
                },
                
                // Toggle wishlist
                toggleWishlist: function(productId) {
                    if (!this.currentUser) {
                        UI.showToast('Prijavite se da biste koristili listu želja', 'warning');
                        this.openModal('loginModal');
                        return;
                    }
                    
                    const products = this.products;
                    const product = products.find(p => p.id === productId);
                    
                    if (!product) return;
                    
                    const wishlist = this.wishlist;
                    const existingIndex = wishlist.findIndex(item => item.id === productId);
                    
                    if (existingIndex >= 0) {
                        // Remove from wishlist
                        wishlist.splice(existingIndex, 1);
                        UI.showToast('Uklonjeno iz liste želja', 'success');
                    } else {
                        // Add to wishlist
                        wishlist.push({
                            id: product.id,
                            title: product.title,
                            price: product.price,
                            image: product.image
                        });
                        UI.showToast('Dodato u listu želja!', 'success');
                    }
                    
                    // Save wishlist
                    Storage.saveWishlist(wishlist);
                    this.wishlist = wishlist;
                    
                    // Update UI
                    UI.updateWishlistDisplay();
                    this.renderAllProducts(); // Re-render to update wishlist buttons
                },
                
                // Process checkout
                processCheckout: function(orderData) {
                    if (this.cart.items.length === 0) {
                        UI.showToast('Korpa je prazna', 'error');
                        return null;
                    }
                    
                    // Create order
                    const order = {
                        customer: {
                            name: Security.sanitize(orderData.name),
                            email: Security.sanitize(orderData.email),
                            phone: Security.sanitize(orderData.phone),
                            address: Security.sanitize(orderData.address)
                        },
                        items: [...this.cart.items],
                        subtotal: this.cart.subtotal,
                        tax: this.cart.tax,
                        shipping: this.cart.shipping,
                        total: this.cart.total,
                        paymentMethod: orderData.paymentMethod,
                        status: 'processing',
                        createdAt: new Date().toISOString()
                    };
                    
                    // Save order
                    const orderId = Storage.saveOrder(order);
                    order.id = orderId;
                    
                    // Clear cart
                    this.cart = { items: [], subtotal: 0, tax: 0, shipping: 0, total: 0 };
                    Storage.saveCart(this.cart);
                    
                    // Update UI
                    UI.updateCartDisplay();
                    this.orders = Storage.getOrders();
                    
                    // If user is logged in, add order to their profile
                    if (this.currentUser) {
                        // Orders are already saved globally, user-specific filtering happens in UI
                    }
                    
                    return order;
                },
                
                // Add new product (admin)
                addProduct: function(productData) {
                    if (!this.currentUser || this.currentUser.role !== 'admin') {
                        UI.showToast('Nemate administratorske privilegije', 'error');
                        return false;
                    }
                    
                    const newProduct = {
                        title: Security.sanitize(productData.title),
                        description: Security.sanitize(productData.description),
                        price: parseInt(productData.price),
                        category: productData.category,
                        stock: parseInt(productData.stock),
                        platform: 'Multi',
                        developer: 'Various',
                        releaseDate: new Date().toISOString().split('T')[0],
                        rating: 0,
                        tags: [productData.category],
                        image: 'game' + (Math.floor(Math.random() * 8) + 1),
                        featured: false
                    };
                    
                    if (Storage.saveProduct(newProduct)) {
                        this.products = Storage.getProducts();
                        this.renderAllProducts();
                        this.renderFeaturedProducts();
                        UI.updateAdminStats();
                        UI.showToast('Proizvod uspešno dodat!', 'success');
                        this.closeModal('addProductModal');
                        return true;
                    }
                    
                    UI.showToast('Greška pri dodavanju proizvoda', 'error');
                    return false;
                },
                
                // Navigate to page
                navigateTo: function(page) {
                    // Hide all pages
                    const pages = ['homePage', 'shopPage', 'categoriesPage', 'dashboardPage'];
                    pages.forEach(pageId => {
                        const element = document.getElementById(pageId);
                        if (element) element.style.display = 'none';
                    });
                    
                    // Show selected page
                    const targetPage = document.getElementById(page + 'Page');
                    if (targetPage) {
                        targetPage.style.display = 'block';
                        this.currentPage = page;
                        
                        // Update nav links
                        document.querySelectorAll('.nav-link').forEach(link => {
                            link.classList.remove('active');
                            if (link.getAttribute('data-page') === page) {
                                link.classList.add('active');
                            }
                        });
                        
                        // Update dashboard nav if on dashboard
                        if (page === 'dashboard') {
                            this.showDashboardSection('orders');
                        }
                        
                        // Scroll to top
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },
                
                // Show dashboard section
                showDashboardSection: function(section) {
                    const sections = ['dashboardOrders', 'dashboardWishlist', 'dashboardProfile'];
                    sections.forEach(sectionId => {
                        const element = document.getElementById(sectionId);
                        if (element) element.classList.remove('active');
                    });
                    
                    const targetSection = document.getElementById('dashboard' + section.charAt(0).toUpperCase() + section.slice(1));
                    if (targetSection) {
                        targetSection.classList.add('active');
                    }
                    
                    // Update nav links
                    document.querySelectorAll('.dashboard-nav-link').forEach(link => {
                        link.classList.remove('active');
                        if (link.getAttribute('data-dashboard-section') === section) {
                            link.classList.add('active');
                        }
                    });
                    
                    // Load section data
                    if (section === 'orders') {
                        this.loadUserOrders();
                    } else if (section === 'wishlist') {
                        this.loadUserWishlist();
                    } else if (section === 'profile') {
                        this.loadUserProfile();
                    }
                },
                
                // Load user orders
                loadUserOrders: function() {
                    if (!this.currentUser) return;
                    
                    const orders = this.orders;
                    const userOrders = orders.filter(order => 
                        order.customer.email === this.currentUser.email
                    );
                    
                    const tableBody = document.getElementById('userOrdersTable');
                    if (tableBody) {
                        if (userOrders.length === 0) {
                            tableBody.innerHTML = `
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 40px; color: var(--gray);">
                                        <i class="fas fa-shopping-bag" style="font-size: 2rem; margin-bottom: 16px; display: block;"></i>
                                        <p>Nemate nijednu porudžbinu</p>
                                    </td>
                                </tr>
                            `;
                        } else {
                            tableBody.innerHTML = userOrders.map(order => `
                                <tr>
                                    <td>${order.id}</td>
                                    <td>${UI.formatDate(order.createdAt)}</td>
                                    <td>
                                        <span class="badge ${
                                            order.status === 'completed' ? 'badge-success' :
                                            order.status === 'processing' ? 'badge-primary' :
                                            order.status === 'shipped' ? 'badge-warning' :
                                            'badge-danger'
                                        }">
                                            ${order.status}
                                        </span>
                                    </td>
                                    <td>${UI.formatCurrency(order.total)}</td>
                                    <td>
                                        <button class="btn btn-outline btn-small view-order-btn" data-order-id="${order.id}">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline btn-small download-invoice-btn" data-order-id="${order.id}">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </td>
                                </tr>
                            `).join('');
                        }
                    }
                },
                
                // Load user wishlist in dashboard
                loadUserWishlist: function() {
                    const wishlist = this.wishlist;
                    const products = this.products;
                    const wishlistProducts = products.filter(p => 
                        wishlist.some(w => w.id === p.id)
                    );
                    
                    const container = document.getElementById('userWishlist');
                    if (container) {
                        if (wishlistProducts.length === 0) {
                            container.innerHTML = `
                                <div style="text-align: center; padding: 40px; color: var(--gray); width: 100%;">
                                    <i class="fas fa-heart" style="font-size: 2rem; margin-bottom: 16px; display: block;"></i>
                                    <p>Lista želja je prazna</p>
                                </div>
                            `;
                        } else {
                            container.innerHTML = wishlistProducts.map(product => 
                                UI.renderProductCard(product)
                            ).join('');
                        }
                    }
                },
                
                // Load user profile
                loadUserProfile: function() {
                    if (!this.currentUser) return;
                    
                    const users = Storage.getUsers();
                    const user = users.find(u => u.id === this.currentUser.userId);
                    
                    if (user) {
                        const profileName = document.getElementById('profileName');
                        const profileEmail = document.getElementById('profileEmail');
                        const profilePhone = document.getElementById('profilePhone');
                        const profileAddress = document.getElementById('profileAddress');
                        
                        if (profileName) profileName.value = user.name || '';
                        if (profileEmail) profileEmail.value = user.email || '';
                        if (profilePhone) profilePhone.value = user.phone || '';
                        if (profileAddress) profileAddress.value = user.address || '';
                    }
                },
                
                // Render featured products
                renderFeaturedProducts: function() {
                    const featuredProducts = this.products.filter(p => p.featured);
                    const container = document.getElementById('featuredProducts');
                    
                    if (container && featuredProducts.length > 0) {
                        container.innerHTML = featuredProducts.map(product => 
                            UI.renderProductCard(product)
                        ).join('');
                    }
                },
                
                // Render all products
                renderAllProducts: function() {
                    const container = document.getElementById('allProducts');
                    
                    if (container) {
                        container.innerHTML = this.products.map(product => 
                            UI.renderProductCard(product)
                        ).join('');
                    }
                },
                
                // Render categories
                renderCategories: function() {
                    const categories = [
                        { id: 'rpg', name: 'RPG Igre', icon: 'fas fa-dragon', color: '#6366f1' },
                        { id: 'fps', name: 'FPS/Action', icon: 'fas fa-crosshairs', color: '#ef4444' },
                        { id: 'strategy', name: 'Strategija', icon: 'fas fa-chess', color: '#10b981' },
                        { id: 'sports', name: 'Sport', icon: 'fas fa-futbol', color: '#f59e0b' },
                        { id: 'adventure', name: 'Avantura', icon: 'fas fa-mountain', color: '#8b5cf6' },
                        { id: 'indie', name: 'Indie Igre', icon: 'fas fa-gamepad', color: '#ec4899' }
                    ];
                    
                    const container = document.getElementById('categoriesGrid');
                    
                    if (container) {
                        container.innerHTML = categories.map(category => `
                            <div class="product-card">
                                <div class="card" style="text-align: center; cursor: pointer;" data-category="${category.id}">
                                    <div style="font-size: 3rem; color: ${category.color}; margin-bottom: 16px;">
                                        <i class="${category.icon}"></i>
                                    </div>
                                    <h3 class="product-title">${category.name}</h3>
                                    <p class="product-description">
                                        ${this.products.filter(p => p.category === category.id).length} igara dostupno
                                    </p>
                                    <button class="btn btn-outline btn-small view-category-btn" data-category="${category.id}">
                                        <i class="fas fa-arrow-right"></i> Pogledaj
                                    </button>
                                </div>
                            </div>
                        `).join('');
                    }
                },
                
                // Open modal
                openModal: function(modalId) {
                    const modal = document.getElementById(modalId);
                    if (modal) {
                        modal.classList.add('show');
                        modal.setAttribute('aria-hidden', 'false');
                        document.body.style.overflow = 'hidden';
                        
                        // Focus first input
                        const firstInput = modal.querySelector('input, select, textarea');
                        if (firstInput) firstInput.focus();
                    }
                },
                
                // Close modal
                closeModal: function(modalId) {
                    const modal = document.getElementById(modalId);
                    if (modal) {
                        modal.classList.remove('show');
                        modal.setAttribute('aria-hidden', 'true');
                        document.body.style.overflow = 'auto';
                        
                        // Clear form
                        const form = modal.querySelector('form');
                        if (form) form.reset();
                    }
                },
                
                // Toggle sidebar
                toggleSidebar: function(sidebarId) {
                    const sidebar = document.getElementById(sidebarId);
                    if (sidebar) {
                        sidebar.classList.toggle('show');
                        sidebar.setAttribute('aria-hidden', sidebar.classList.contains('show') ? 'false' : 'true');
                        
                        if (sidebar.classList.contains('show')) {
                            document.body.style.overflow = 'hidden';
                            
                            // Update content
                            if (sidebarId === 'cartSidebar') {
                                UI.updateCartDisplay();
                            } else if (sidebarId === 'wishlistSidebar') {
                                UI.updateWishlistDisplay();
                            } else if (sidebarId === 'adminPanel') {
                                UI.updateAdminStats();
                            }
                        } else {
                            document.body.style.overflow = 'auto';
                        }
                    }
                },
                
                // Setup theme
                setupTheme: function() {
                    const savedTheme = localStorage.getItem('bge_theme') || 'dark';
                    document.documentElement.setAttribute('data-theme', savedTheme);
                    
                    const themeToggle = document.getElementById('themeToggle');
                    if (themeToggle) {
                        themeToggle.innerHTML = savedTheme === 'dark' ? 
                            '<i class="fas fa-sun"></i>' : 
                            '<i class="fas fa-moon"></i>';
                    }
                },
                
                // Toggle theme
                toggleTheme: function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('bge_theme', newTheme);
                    
                    const themeToggle = document.getElementById('themeToggle');
                    if (themeToggle) {
                        themeToggle.innerHTML = newTheme === 'dark' ? 
                            '<i class="fas fa-sun"></i>' : 
                            '<i class="fas fa-moon"></i>';
                    }
                    
                    UI.showToast(`Tema promenjena u ${newTheme === 'dark' ? 'tamni' : 'svetli'} režim`, 'success');
                },
                
                // Check for admin user (for demo purposes)
                checkAdminUser: function() {
                    // Check if admin user exists, if not create one
                    const users = Storage.getUsers();
                    const adminExists = users.some(u => u.role === 'admin');
                    
                    if (!adminExists) {
                        const adminUser = {
                            name: 'Admin',
                            email: 'admin@balkan-gaming.com',
                            password: 'Admin123!',
                            role: 'admin',
                            createdAt: new Date().toISOString()
                        };
                        
                        Storage.saveUser(adminUser);
                        console.log('Admin user created: admin@balkan-gaming.com / Admin123!');
                    }
                },
                
                // Setup event listeners
                setupEventListeners: function() {
                    const self = this;
                    
                    // Navigation
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            const page = this.getAttribute('data-page');
                            self.navigateTo(page);
                        });
                    });
                    
                    // Mobile menu toggle
                    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
                    if (mobileMenuToggle) {
                        mobileMenuToggle.addEventListener('click', function() {
                            const navMenu = document.getElementById('navMenu');
                            const isExpanded = this.getAttribute('aria-expanded') === 'true';
                            
                            navMenu.classList.toggle('show');
                            this.setAttribute('aria-expanded', !isExpanded);
                            this.innerHTML = isExpanded ? 
                                '<i class="fas fa-bars"></i>' : 
                                '<i class="fas fa-times"></i>';
                        });
                    }
                    
                    // Close mobile menu when clicking outside
                    document.addEventListener('click', function(e) {
                        const navMenu = document.getElementById('navMenu');
                        const mobileToggle = document.getElementById('mobileMenuToggle');
                        
                        if (navMenu && navMenu.classList.contains('show') && 
                            !navMenu.contains(e.target) && 
                            !mobileToggle.contains(e.target)) {
                            navMenu.classList.remove('show');
                            mobileToggle.setAttribute('aria-expanded', 'false');
                            mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
                        }
                    });
                    
                    // Theme toggle
                    const themeToggle = document.getElementById('themeToggle');
                    if (themeToggle) {
                        themeToggle.addEventListener('click', function() {
                            self.toggleTheme();
                        });
                    }
                    
                    // Cart toggle
                    const cartToggle = document.getElementById('cartToggle');
                    if (cartToggle) {
                        cartToggle.addEventListener('click', function() {
                            self.toggleSidebar('cartSidebar');
                        });
                    }
                    
                    // Close cart
                    const closeCart = document.getElementById('closeCart');
                    if (closeCart) {
                        closeCart.addEventListener('click', function() {
                            self.toggleSidebar('cartSidebar');
                        });
                    }
                    
                    // Wishlist toggle
                    const wishlistToggle = document.getElementById('wishlistToggle');
                    if (wishlistToggle) {
                        wishlistToggle.addEventListener('click', function() {
                            self.toggleSidebar('wishlistSidebar');
                        });
                    }
                    
                    // Close wishlist
                    const closeWishlist = document.getElementById('closeWishlist');
                    if (closeWishlist) {
                        closeWishlist.addEventListener('click', function() {
                            self.toggleSidebar('wishlistSidebar');
                        });
                    }
                    
                    // User toggle
                    const userToggle = document.getElementById('userToggle');
                    if (userToggle) {
                        userToggle.addEventListener('click', function() {
                            if (self.currentUser) {
                                self.navigateTo('dashboard');
                            } else {
                                self.openModal('loginModal');
                            }
                        });
                    }
                    
                    // Admin toggle
                    const adminToggle = document.getElementById('adminToggle');
                    if (adminToggle) {
                        adminToggle.addEventListener('click', function() {
                            self.toggleSidebar('adminPanel');
                        });
                    }
                    
                    // Close admin panel
                    const adminCloseBtn = document.getElementById('adminCloseBtn');
                    if (adminCloseBtn) {
                        adminCloseBtn.addEventListener('click', function() {
                            self.toggleSidebar('adminPanel');
                        });
                    }
                    
                    // Add product button (admin)
                    const adminAddProductBtn = document.getElementById('adminAddProductBtn');
                    if (adminAddProductBtn) {
                        adminAddProductBtn.addEventListener('click', function() {
                            self.openModal('addProductModal');
                        });
                    }
                    
                    // Login form
                    const loginForm = document.getElementById('loginForm');
                    if (loginForm) {
                        loginForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            const email = document.getElementById('loginEmail').value;
                            const password = document.getElementById('loginPassword').value;
                            
                            UI.toggleLoading(this.querySelector('button[type="submit"]'), true);
                            
                            setTimeout(() => {
                                self.login(email, password);
                                UI.toggleLoading(this.querySelector('button[type="submit"]'), false);
                            }, 500);
                        });
                    }
                    
                    // Register form
                    const registerForm = document.getElementById('registerForm');
                    if (registerForm) {
                        registerForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            const name = document.getElementById('registerName').value;
                            const email = document.getElementById('registerEmail').value;
                            const password = document.getElementById('registerPassword').value;
                            const confirmPassword = document.getElementById('registerConfirmPassword').value;
                            const acceptTerms = document.getElementById('acceptTerms').checked;
                            
                            if (!acceptTerms) {
                                UI.showToast('Morate prihvatiti uslove korišćenja', 'error');
                                return;
                            }
                            
                            UI.toggleLoading(this.querySelector('button[type="submit"]'), true);
                            
                            setTimeout(() => {
                                self.register({ name, email, password, confirmPassword });
                                UI.toggleLoading(this.querySelector('button[type="submit"]'), false);
                            }, 500);
                        });
                    }
                    
                    // Forgot password form
                    const forgotPasswordForm = document.getElementById('forgotPasswordForm');
                    if (forgotPasswordForm) {
                        forgotPasswordForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            const email = document.getElementById('forgotPasswordEmail').value;
                            
                            if (!Security.validateEmail(email)) {
                                UI.showToast('Unesite validan email', 'error');
                                return;
                            }
                            
                            UI.toggleLoading(this.querySelector('button[type="submit"]'), true);
                            
                            setTimeout(() => {
                                UI.toggleLoading(this.querySelector('button[type="submit"]'), false);
                                self.closeModal('forgotPasswordModal');
                                UI.showToast('Link za resetovanje lozinke je poslat na email', 'success');
                            }, 1000);
                        });
                    }
                    
                    // Add product form (admin) - ISPRAVLJENA LINIJA OVDE
                    const addProductForm = document.getElementById('addProductForm');
                    if (addProductForm) {
                        addProductForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            const title = document.getElementById('productTitle').value;
                            const description = document.getElementById('productDescription').value;
                            const price = document.getElementById('productPrice').value;
                            const category = document.getElementById('productCategory').value;
                            const stock = document.getElementById('productStock').value;
                            
                            if (!title || !description || !price || !category || !stock) {
                                UI.showToast('Popunite sva polja', 'error');
                                return;
                            }
                            
                            UI.toggleLoading(this.querySelector('button[type="submit"]'), true);
                            
                            setTimeout(() => {
                                self.addProduct({ title, description, price, category, stock });
                                UI.toggleLoading(this.querySelector('button[type="submit"]'), false);
                            }, 500);
                        });
                    }
                    
                    // Profile form
                    const profileForm = document.getElementById('profileForm');
                    if (profileForm) {
                        profileForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            const name = document.getElementById('profileName').value;
                            const phone = document.getElementById('profilePhone').value;
                            const address = document.getElementById('profileAddress').value;
                            
                            UI.toggleLoading(this.querySelector('button[type="submit"]'), true);
                            
                            setTimeout(() => {
                                self.updateProfile({ name, phone, address });
                                UI.toggleLoading(this.querySelector('button[type="submit"]'), false);
                            }, 500);
                        });
                    }
                    
                    // Change password form
                    const changePasswordForm = document.getElementById('changePasswordForm');
                    if (changePasswordForm) {
                        changePasswordForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            const currentPassword = document.getElementById('currentPassword').value;
                            const newPassword = document.getElementById('newPassword').value;
                            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
                            
                            UI.toggleLoading(this.querySelector('button[type="submit"]'), true);
                            
                            setTimeout(() => {
                                self.changePassword({ currentPassword, newPassword, confirmNewPassword });
                                UI.toggleLoading(this.querySelector('button[type="submit"]'), false);
                            }, 500);
                        });
                    }
                    
                    // Logout button
                    const logoutBtn = document.getElementById('logoutBtn');
                    if (logoutBtn) {
                        logoutBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            self.logout();
                        });
                    }
                    
                    // Continue shopping button
                    const continueShoppingBtn = document.getElementById('continueShoppingBtn');
                    if (continueShoppingBtn) {
                        continueShoppingBtn.addEventListener('click', function() {
                            self.toggleSidebar('cartSidebar');
                            self.navigateTo('shop');
                        });
                    }
                    
                    // Checkout button
                    const checkoutBtn = document.getElementById('checkoutBtn');
                    if (checkoutBtn) {
                        checkoutBtn.addEventListener('click', function() {
                            if (self.cart.items.length === 0) {
                                UI.showToast('Korpa je prazna', 'error');
                                return;
                            }
                            
                            self.toggleSidebar('cartSidebar');
                            self.openModal('checkoutModal');
                        });
                    }
                    
                    // Close modal buttons
                    document.querySelectorAll('.modal-close').forEach(button => {
                        button.addEventListener('click', function() {
                            const modal = this.closest('.modal');
                            if (modal) {
                                const modalId = modal.id;
                                self.closeModal(modalId);
                            }
                        });
                    });
                    
                    // Close modals on background click
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.addEventListener('click', function(e) {
                            if (e.target === this) {
                                const modalId = this.id;
                                self.closeModal(modalId);
                            }
                        });
                    });
                    
                    // Modal navigation
                    const showRegisterModal = document.getElementById('showRegisterModal');
                    if (showRegisterModal) {
                        showRegisterModal.addEventListener('click', function(e) {
                            e.preventDefault();
                            self.closeModal('loginModal');
                            self.openModal('registerModal');
                        });
                    }
                    
                    const showLoginModal = document.getElementById('showLoginModalFromRegister');
                    if (showLoginModal) {
                        showLoginModal.addEventListener('click', function(e) {
                            e.preventDefault();
                            self.closeModal('registerModal');
                            self.openModal('loginModal');
                        });
                    }
                    
                    const showForgotPasswordModal = document.getElementById('showForgotPasswordModal');
                    if (showForgotPasswordModal) {
                        showForgotPasswordModal.addEventListener('click', function(e) {
                            e.preventDefault();
                            self.closeModal('loginModal');
                            self.openModal('forgotPasswordModal');
                        });
                    }
                    
                    const showLoginModalFromForgot = document.getElementById('showLoginModalFromForgot');
                    if (showLoginModalFromForgot) {
                        showLoginModalFromForgot.addEventListener('click', function(e) {
                            e.preventDefault();
                            self.closeModal('forgotPasswordModal');
                            self.openModal('loginModal');
                        });
                    }
                    
                    const closeAddProductModal = document.getElementById('closeAddProductModal');
                    if (closeAddProductModal) {
                        closeAddProductModal.addEventListener('click', function() {
                            self.closeModal('addProductModal');
                        });
                    }
                    
                    const closeCheckoutModal = document.getElementById('closeCheckoutModal');
                    if (closeCheckoutModal) {
                        closeCheckoutModal.addEventListener('click', function() {
                            self.closeModal('checkoutModal');
                        });
                    }
                    
                    // Footer login button
                    const footerLoginBtn = document.getElementById('footerLoginBtn');
                    if (footerLoginBtn) {
                        footerLoginBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            self.openModal('loginModal');
                        });
                    }
                    
                    // Explore categories button
                    const exploreCategoriesBtn = document.getElementById('exploreCategoriesBtn');
                    if (exploreCategoriesBtn) {
                        exploreCategoriesBtn.addEventListener('click', function() {
                            self.navigateTo('categories');
                        });
                    }
                    
                    // Dashboard navigation
                    document.querySelectorAll('.dashboard-nav-link').forEach(link => {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            const section = this.getAttribute('data-dashboard-section');
                            self.showDashboardSection(section);
                        });
                    });
                    
                    // Checkout flow
                    const customerInfoForm = document.getElementById('customerInfoForm');
                    if (customerInfoForm) {
                        customerInfoForm.addEventListener('submit', function(e) {
                            e.preventDefault();
                            
                            // Validate form
                            const name = document.getElementById('customerName').value;
                            const email = document.getElementById('customerEmail').value;
                            const phone = document.getElementById('customerPhone').value;
                            const address = document.getElementById('customerAddress').value;
                            
                            if (!name || !email || !phone || !address) {
                                UI.showToast('Popunite sva polja', 'error');
                                return;
                            }
                            
                            if (!Security.validateEmail(email)) {
                                UI.showToast('Unesite validan email', 'error');
                                return;
                            }
                            
                            // Go to payment step
                            document.querySelectorAll('.checkout-step').forEach(step => {
                                step.classList.remove('active');
                            });
                            document.querySelector('.checkout-step[data-step="2"]').classList.add('active');
                            
                            document.querySelectorAll('.checkout-section').forEach(section => {
                                section.classList.remove('active');
                            });
                            document.getElementById('checkoutStep2').classList.add('active');
                        });
                    }
                    
                    // Payment method selection
                    document.querySelectorAll('input[name="paymentMethod"]').forEach(radio => {
                        radio.addEventListener('change', function() {
                            const cardPaymentFields = document.getElementById('cardPaymentFields');
                            if (this.value === 'card') {
                                cardPaymentFields.style.display = 'block';
                            } else {
                                cardPaymentFields.style.display = 'none';
                            }
                        });
                    });
                    
                    // Back to info button in checkout
                    const backToInfoBtn = document.getElementById('backToInfoBtn');
                    if (backToInfoBtn) {
                        backToInfoBtn.addEventListener('click', function() {
                            document.querySelectorAll('.checkout-step').forEach(step => {
                                step.classList.remove('active');
                            });
                            document.querySelector('.checkout-step[data-step="1"]').classList.add('active');
                            
                            document.querySelectorAll('.checkout-section').forEach(section => {
                                section.classList.remove('active');
                            });
                            document.getElementById('checkoutStep1').classList.add('active');
                        });
                    }
                    
                    // Process payment button
                    const processPaymentBtn = document.getElementById('processPaymentBtn');
                    if (processPaymentBtn) {
                        processPaymentBtn.addEventListener('click', function() {
                            UI.toggleLoading(this, true);
                            
                            // Get payment method
                            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
                            
                            // Get customer info
                            const customerInfo = {
                                name: document.getElementById('customerName').value,
                                email: document.getElementById('customerEmail').value,
                                phone: document.getElementById('customerPhone').value,
                                address: document.getElementById('customerAddress').value,
                                paymentMethod: paymentMethod
                            };
                            
                            // Validate card details if paying by card
                            if (paymentMethod === 'card') {
                                const cardNumber = document.getElementById('cardNumber').value;
                                const cardExpiry = document.getElementById('cardExpiry').value;
                                const cardCvc = document.getElementById('cardCvc').value;
                                
                                if (!cardNumber || !cardExpiry || !cardCvc) {
                                    UI.showToast('Popunite sve podatke kartice', 'error');
                                    UI.toggleLoading(this, false);
                                    return;
                                }
                            }
                            
                            setTimeout(() => {
                                // Process order
                                const order = self.processCheckout(customerInfo);
                                
                                if (order) {
                                    // Go to confirmation step
                                    document.querySelectorAll('.checkout-step').forEach(step => {
                                        step.classList.remove('active');
                                        step.classList.add('completed');
                                    });
                                    document.querySelector('.checkout-step[data-step="3"]').classList.add('active');
                                    
                                    document.querySelectorAll('.checkout-section').forEach(section => {
                                        section.classList.remove('active');
                                    });
                                    document.getElementById('checkoutStep3').classList.add('active');
                                    
                                    // Display order ID
                                    const orderIdDisplay = document.getElementById('orderIdDisplay');
                                    if (orderIdDisplay) {
                                        orderIdDisplay.textContent = `Broj porudžbine: ${order.id}`;
                                    }
                                }
                                
                                UI.toggleLoading(this, false);
                            }, 1500);
                        });
                    }
                    
                    // Download invoice button
                    const downloadInvoiceBtn = document.getElementById('downloadInvoiceBtn');
                    if (downloadInvoiceBtn) {
                        downloadInvoiceBtn.addEventListener('click', function() {
                            // Get the latest order (for demo)
                            const orders = self.orders;
                            if (orders.length > 0) {
                                const latestOrder = orders[orders.length - 1];
                                UI.generateInvoice(latestOrder);
                            }
                        });
                    }
                    
                    // Continue shopping after checkout
                    const continueShoppingAfterCheckoutBtn = document.getElementById('continueShoppingAfterCheckoutBtn');
                    if (continueShoppingAfterCheckoutBtn) {
                        continueShoppingAfterCheckoutBtn.addEventListener('click', function() {
                            self.closeModal('checkoutModal');
                            self.navigateTo('shop');
                        });
                    }
                    
                    // Product search and filter
                    const searchProducts = document.getElementById('searchProducts');
                    const sortProducts = document.getElementById('sortProducts');
                    const filterCategory = document.getElementById('filterCategory');
                    
                    if (searchProducts) {
                        searchProducts.addEventListener('input', function() {
                            self.filterProducts();
                        });
                    }
                    
                    if (sortProducts) {
                        sortProducts.addEventListener('change', function() {
                            self.filterProducts();
                        });
                    }
                    
                    if (filterCategory) {
                        filterCategory.addEventListener('change', function() {
                            self.filterProducts();
                        });
                    }
                    
                    // View category buttons
                    document.addEventListener('click', function(e) {
                        if (e.target.closest('.view-category-btn')) {
                            const button = e.target.closest('.view-category-btn');
                            const category = button.getAttribute('data-category');
                            
                            // Navigate to shop and filter by category
                            self.navigateTo('shop');
                            
                            if (filterCategory) {
                                filterCategory.value = category;
                                self.filterProducts();
                            }
                        }
                        
                        if (e.target.closest('.view-category-card')) {
                            const card = e.target.closest('.view-category-card');
                            const category = card.getAttribute('data-category');
                            
                            self.navigateTo('shop');
                            
                            if (filterCategory) {
                                filterCategory.value = category;
                                self.filterProducts();
                            }
                        }
                    });
                    
                    // Delegate dynamic events
                    document.addEventListener('click', function(e) {
                        // Add to cart button
                        if (e.target.closest('.add-to-cart-btn')) {
                            const button = e.target.closest('.add-to-cart-btn');
                            const productId = button.getAttribute('data-product-id');
                            
                            // Add animation
                            button.innerHTML = '<i class="fas fa-check"></i> Dodato!';
                            button.classList.add('btn-success');
                            
                            self.addToCart(productId);
                            
                            setTimeout(() => {
                                button.innerHTML = '<i class="fas fa-cart-plus"></i> DODAJ';
                                button.classList.remove('btn-success');
                            }, 1000);
                        }
                        
                        // Add to cart from wishlist
                        if (e.target.closest('.add-to-cart-from-wishlist')) {
                            const button = e.target.closest('.add-to-cart-from-wishlist');
                            const productId = button.getAttribute('data-product-id');
                            
                            self.addToCart(productId);
                            self.removeFromWishlist(productId);
                        }
                        
                        // Toggle wishlist button
                        if (e.target.closest('.toggle-wishlist-btn')) {
                            const button = e.target.closest('.toggle-wishlist-btn');
                            const productId = button.getAttribute('data-product-id');
                            
                            self.toggleWishlist(productId);
                        }
                        
                        // Remove from wishlist
                        if (e.target.closest('.remove-from-wishlist')) {
                            const button = e.target.closest('.remove-from-wishlist');
                            const productId = button.getAttribute('data-product-id');
                            
                            self.removeFromWishlist(productId);
                        }
                        
                        // Decrease quantity in cart
                        if (e.target.closest('.decrease-quantity')) {
                            const button = e.target.closest('.decrease-quantity');
                            const productId = button.getAttribute('data-item-id');
                            
                            self.updateCartQuantity(productId, -1);
                        }
                        
                        // Increase quantity in cart
                        if (e.target.closest('.increase-quantity')) {
                            const button = e.target.closest('.increase-quantity');
                            const productId = button.getAttribute('data-item-id');
                            
                            self.updateCartQuantity(productId, 1);
                        }
                        
                        // Remove from cart
                        if (e.target.closest('.remove-from-cart')) {
                            const button = e.target.closest('.remove-from-cart');
                            const productId = button.getAttribute('data-item-id');
                            
                            self.removeFromCart(productId);
                        }
                        
                        // View order button
                        if (e.target.closest('.view-order-btn')) {
                            const button = e.target.closest('.view-order-btn');
                            const orderId = button.getAttribute('data-order-id');
                            
                            UI.showToast(`Prikaz porudžbine ${orderId} (demo)`, 'info');
                        }
                        
                        // Download invoice from orders table
                        if (e.target.closest('.download-invoice-btn')) {
                            const button = e.target.closest('.download-invoice-btn');
                            const orderId = button.getAttribute('data-order-id');
                            
                            const orders = self.orders;
                            const order = orders.find(o => o.id === orderId);
                            
                            if (order) {
                                UI.generateInvoice(order);
                            }
                        }
                    });
                    
                    // Keyboard shortcuts
                    document.addEventListener('keydown', function(e) {
                        // Close modals with Escape
                        if (e.key === 'Escape') {
                            const openModal = document.querySelector('.modal.show');
                            if (openModal) {
                                self.closeModal(openModal.id);
                            }
                            
                            const openSidebar = document.querySelector('.cart-sidebar.show');
                            if (openSidebar) {
                                self.toggleSidebar(openSidebar.id);
                            }
                            
                            const openAdmin = document.querySelector('.admin-panel.show');
                            if (openAdmin) {
                                self.toggleSidebar('adminPanel');
                            }
                        }
                        
                        // Cart shortcut (C)
                        if (e.key === 'c' && !e.ctrlKey && !e.altKey && !e.metaKey) {
                            self.toggleSidebar('cartSidebar');
                            e.preventDefault();
                        }
                        
                        // Search focus (/) - only if not in input
                        if (e.key === '/' && !e.ctrlKey && !e.altKey && !e.metaKey) {
                            const activeElement = document.activeElement;
                            if (!activeElement || (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA')) {
                                const searchInput = document.getElementById('searchProducts');
                                if (searchInput) {
                                    searchInput.focus();
                                    e.preventDefault();
                                }
                            }
                        }
                    });
                    
                    // Update session activity on user interaction
                    document.addEventListener('click', function() {
                        self.updateSessionActivity();
                    });
                    
                    document.addEventListener('keydown', function() {
                        self.updateSessionActivity();
                    });
                },
                
                // Filter and sort products
                filterProducts: function() {
                    const searchTerm = document.getElementById('searchProducts')?.value.toLowerCase() || '';
                    const sortBy = document.getElementById('sortProducts')?.value || 'name_asc';
                    const category = document.getElementById('filterCategory')?.value || '';
                    
                    let filteredProducts = [...this.products];
                    
                    // Filter by search term
                    if (searchTerm) {
                        filteredProducts = filteredProducts.filter(product => 
                            product.title.toLowerCase().includes(searchTerm) ||
                            product.description.toLowerCase().includes(searchTerm) ||
                            product.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                        );
                    }
                    
                    // Filter by category
                    if (category) {
                        filteredProducts = filteredProducts.filter(product => 
                            product.category === category
                        );
                    }
                    
                    // Sort products
                    filteredProducts.sort((a, b) => {
                        switch (sortBy) {
                            case 'name_asc':
                                return a.title.localeCompare(b.title);
                            case 'name_desc':
                                return b.title.localeCompare(a.title);
                            case 'price_asc':
                                return a.price - b.price;
                            case 'price_desc':
                                return b.price - a.price;
                            case 'newest':
                                return new Date(b.releaseDate) - new Date(a.releaseDate);
                            default:
                                return 0;
                        }
                    });
                    
                    // Render filtered products
                    const container = document.getElementById('allProducts');
                    if (container) {
                        if (filteredProducts.length === 0) {
                            container.innerHTML = `
                                <div style="text-align: center; padding: 40px; color: var(--gray); width: 100%; grid-column: 1 / -1;">
                                    <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 16px; display: block;"></i>
                                    <p>Nema pronađenih proizvoda</p>
                                    <button class="btn btn-outline" style="margin-top: 16px;" id="clearFiltersBtn">
                                        <i class="fas fa-times"></i> Poništi filtere
                                    </button>
                                </div>
                            `;
                            
                            // Add clear filters button event
                            setTimeout(() => {
                                const clearFiltersBtn = document.getElementById('clearFiltersBtn');
                                if (clearFiltersBtn) {
                                    clearFiltersBtn.addEventListener('click', function() {
                                        document.getElementById('searchProducts').value = '';
                                        document.getElementById('filterCategory').value = '';
                                        AppState.filterProducts();
                                    });
                                }
                            }, 0);
                        } else {
                            container.innerHTML = filteredProducts.map(product => 
                                UI.renderProductCard(product)
                            ).join('');
                        }
                    }
                },
                
                // Remove from wishlist
                removeFromWishlist: function(productId) {
                    const wishlist = this.wishlist;
                    const existingIndex = wishlist.findIndex(item => item.id === productId);
                    
                    if (existingIndex >= 0) {
                        wishlist.splice(existingIndex, 1);
                        Storage.saveWishlist(wishlist);
                        this.wishlist = wishlist;
                        
                        UI.updateWishlistDisplay();
                        this.renderAllProducts(); // Re-render to update wishlist buttons
                        UI.showToast('Uklonjeno iz liste želja', 'success');
                    }
                }
            };
            
            // ============================================
            // INITIALIZE APPLICATION
            // ============================================
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize app
                AppState.init();
                
                // Log app info
                console.log(`${CONFIG.APP_NAME} v${CONFIG.VERSION} initialized`);
                console.log('Storage initialized with:', {
                    products: AppState.products.length,
                    users: AppState.users.length,
                    orders: AppState.orders.length
                });
            });
            
            // ============================================
            // GLOBAL ACCESS FOR DEBUGGING
            // ============================================
            window.BalkanGaming = {
                AppState,
                Storage,
                UI,
                Security,
                CONFIG
            };
            
        })();
    </script>
</body>
</html>